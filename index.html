<!DOCTYPE html>
<html lang="es">

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&family=Jersey+15&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon"
        href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Joker Card</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon.png"
        type="image/x-icon">
    <style>
        /* Webkit (Chrome, Edge, Safari) */
        ::-webkit-scrollbar {
            width: 0;
        }

        html {
            background-color: black;
            background-image: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/background.png');
            background-repeat: repeat-y;
            background-size: contain;
            background-position: center;
            min-height: 100vh;
            width: 100vw;
            box-sizing: border-box;
            overflow-x: hidden;
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/hover.cur'), auto !important;
        }

        img,
        .clear-search,
        button,
        .modal-close,
        .modal-nav {
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/cursor.cur'), auto !important;
        }

        input {
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/write.cur'), auto !important;
        }

        body {
            font-family: 'Jersey 15';
            font-weight: lighter;
            margin: 0;
        }

        .content {
            width: 75%;
            margin: 30px auto;
            /* Centra el contenido */
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 10px;
        }

        .itemgrid,
        .trinketgrid,
        .cardgrid {
            border-radius: 20px;
            padding: 0;
        }

        /* Nueva clase para cuando los grids están activos */
        .itemgrid.active,
        .trinketgrid.active,
        .cardgrid.active {
            padding: 10px 0;
        }

        .itemgrid {
            background: rgba(255, 255, 0, 0.08);
        }

        .trinketgrid {
            background: rgba(128, 128, 128, 0.12);
        }

        .cardgrid {
            background: rgba(165, 104, 42, 0.15);
        }

        h2 {
            color: rgb(240, 234, 234);
            text-align: center;
            font-family: 'Jersey 15';
            margin: 0 0;
            text-shadow: rgb(18, 13, 13) 5px 5px 0px, rgb(0, 0, 0) 0px 0px 10px;
            font-size: 5em;
            letter-spacing: 5px;
        }

        h3 {
            text-align: center;
            margin: 0;
            font-family: 'Jersey 15';
            font-weight: lighter;
            font-size: 2em;
        }

        p {
            font-size: 1.5em;
        }

        .img-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            /* Menor separación */
            align-items: flex-end;
            /* Alinea arriba */
            justify-content: center;
            /* Centra horizontalmente */
            margin: 0px auto;
            /* Centra el grid en la pantalla */
        }

        .img-grid img {
            image-rendering: pixelated;
            display: block;
            margin: 0;
            transition: all 0.2s;
            z-index: 1;
            cursor: pointer;
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            border: 10px inset #99866e;
            background: #f6d6b0;
            padding: 1em 4em;
            border-radius: 8px;
            min-width: 200px;
            max-width: 550px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-content img {
            image-rendering: pixelated;
        }

        .modal-close {
            position: absolute;
            right: 1em;
            top: 1em;
            cursor: pointer;
            font-size: 2em;
        }

        .search-bar-content {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }

        .search-bar {
            margin-top: 5px;
            width: 94%;
            padding: 10px 30px 10px 10px;
            /* Agregado padding-right para dar espacio a la x */
            font-size: 2em;
            border-radius: 8px;
            border: 4px inset #99866e;
            background: #f6d6b0;
            color: #222;
            font-family: 'Jersey 15', Arial, sans-serif;
        }

        .search-bar-container {
            position: relative;
            width: 65%;
        }

        .clear-search {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 3em;
            color: #614e3c;
            display: none;
            user-select: none;
            padding: 5px;
        }

        .clear-search:hover {
            color: #000000;
        }

        .lang-img {
            padding: 5px;
            margin-top: 5px;
            margin-left: 10px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            image-rendering: pixelated;
        }

        .info-img {
            padding: 5px;
            margin-top: 5px;
            margin-right: 10px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            image-rendering: pixelated;
        }

        .filter-bar {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10;
            display: flex;
            gap: 5px;
            padding: 10px;
            justify-content: center;
            border-radius: 10px;
        }

        .filter-btn {
            font-family: 'Jersey 15', Arial, sans-serif;
            font-size: 1.2em;
            padding: 0;
            /* Elimina padding para que la imagen ocupe todo el botón */
            padding-bottom: 4px;
            border-radius: 10px;
            border: outset 3px #99866e;
            background: #99866e;
            color: #222;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            outline: none;
            width: 100px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .filter-btn img {
            width: 95%;
            height: 95%;
            object-fit: contain;
            pointer-events: none;
            /* Permite que el click pase al botón */
            display: block;
            image-rendering: pixelated;
            filter: brightness(75%) saturate(0.25);

        }

        .filter-btn.active {
            background: #f6d6b0;
            font-weight: bold;
            box-shadow: 0 0 8px #fff2;
        }

        .filter-btn.active img {
            filter: brightness(100%) saturate(100%);
        }

        .cat-corner {
            position: absolute;
            top: 1em;
            left: 1em;
            width: 125px;
            height: 125px;
            z-index: 10;
            pointer-events: none;
            filter: drop-shadow(0 0 5px #000000);
        }

        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 5em;
            color: #614e3c;
            cursor: pointer;
            padding: 0px;
            text-shadow: 2px 2px 2px rgba(0, 0, 0, 0.5);
            transition: color 0.2s;
            user-select: none;
        }

        .modal-nav:hover {
            color: #000000;
        }

        .modal-prev {
            left: 10px;
        }

        .modal-next {
            right: 10px;
        }

        #items-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        #items-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }

        #items-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        #trinkets-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }

        #trinkets-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }

        #trinkets-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        #items-header button,
        #trinkets-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin: 0;
            display: flex;
            align-items: center;
            border-radius: 100%;
            filter: brightness(50%) saturate(100%) blur(1px);
            transition: all 0.2s;

        }

        #items-header button.active,
        #trinkets-header button.active {
            background: rgba(246, 214, 176, 0.2);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
            filter: blur(0px);
        }

        #items-header img,
        #trinkets-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        .img-wrap {
            display: inline-block;
        }

        .img-wrap.cat-up,
        .img-wrap.cat-down {
            animation: pixel-stretch 10s infinite;
        }

        @keyframes pixel-stretch {

            0%,
            93%,
            98%,
            100% {
                transform: scaleX(1) scaleY(1);
            }

            94% {
                transform: scaleX(1.2) scaleY(0.9);
            }

            95% {
                transform: scaleX(0.8) scaleY(1.1);
            }

            96% {
                transform: scaleX(1.15) scaleY(0.85);
            }

            97% {
                transform: scaleX(0.85) scaleY(1.15);
            }
        }

        .img-wrap img:hover {
            transform: scale(1.5);
            z-index: 1000;
            filter: drop-shadow(0 0 1px #ffffff) drop-shadow(0 0 1px #ffffff) drop-shadow(0 0 1px #ffffff) drop-shadow(0 0 10px #ff0000);
        }

        .rainbow-effect {
            animation: rainbow-hue 2s linear infinite;
            filter: hue-rotate(0deg);
        }

        @keyframes rainbow-hue {
            0% {
                filter: hue-rotate(0deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        .brimstone-laser {
            filter: brightness(1.5) blur(1px);
            position: fixed;
            pointer-events: none;
            overflow: visible;
            /* Añade estas dos líneas para que el pseudo-elemento herede la rotación */
            transform-origin: top center;
        }

        .brimstone-laser::after {
            content: "";
            position: absolute;
            left: 50%;
            bottom: 0;
            width: 60px;
            height: 40px;
            background: radial-gradient(ellipse at center, #ffae00 60%, #ff2222 100%, transparent 100%);
            transform: translateX(-50%) rotate(var(--curve-rotate, 0deg)) translateY(var(--curve-translate, 0px));
            opacity: 0.8;
            z-index: 10000;
            pointer-events: none;
        }

        .azazel-hide {
            opacity: 0 !important;
            pointer-events: none !important;
        }

        @media (max-width: 700px) {
            html {
                background-color: rgb(19, 12, 9);
                background-image: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/background_mobile.png');
                background-repeat: no-repeat;
                background-size: cover;
            }

            #trinkets-header,
            #items-header {
                gap: 10px;
            }

            #items-header img,
            #trinkets-header img {
                width: 38px;
                height: 38px;
            }

            h2 {
                font-size: 3.5em;
            }

            .content {
                width: 95vw;
                padding: 2px;
                border-radius: 0;
                margin-top: 0;
            }

            .img-grid {
                gap: 5px;
                /* Menor separación */
            }

            .img-grid img {
                width: 50px;
                height: 50px;
            }

            .search-bar-content {
                width: 95vw;
                margin: 0;
                padding: 0;
                justify-content: center;
            }

            .search-bar {
                font-size: 1em;
                padding: 10px 30px 10px 10px;
                /* Agregado padding-right para dar espacio a la x */
                width: 70vw;
                box-sizing: border-box;
            }

            .search-bar-container {
                width: 70vw;
            }

            .clear-search {
                font-size: 2em;
                right: 8px;
            }

            .lang-img {
                width: 40px;
                height: 40px;
                margin-left: 10px;
                padding: 2px;
            }

            .info-img {
                width: 40px;
                height: 40px;
                margin-right: 10px;
                padding: 2px;
            }

            .filter-bar {
                flex-wrap: wrap;
                gap: 2px;
                padding: 5px;
            }

            .filter-btn {
                width: 55px;
                height: 40px;
                font-size: .8em;
                padding-bottom: 2px;
            }

            .itemgrid,
            .trinketgrid,
            .cardgrid {
                padding: 0px;
            }

            .modal-content {
                max-width: 70vw;
                padding: 1em 2em;
            }

            .modal-close {
                right: .2em;
                top: 0;
                font-size: 3em;
            }

            .cat-corner {
                top: 0;
                left: .2em;
                width: 100px;
                height: 100px;
            }

            .modal-nav {
                font-size: 2em;
            }

            .modal-prev {
                left: 5px;
            }

            .modal-next {
                right: 5px;
            }
        }
    </style>
</head>

<body>
    <div class="content">
        <!-- Search bar -->
        <div class="search-bar-content">
            <img id="info-btn" src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/info.png"
                alt="Cambiar idioma" class="info-img">
            <div class="search-bar-container">
                <input class="search-bar" id="search-bar" type="text" placeholder="Nombre, habitación, etc...">
                <span class="clear-search" id="clear-search">&times;</span>
            </div>
            <img id="lang-toggle"
                src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/languages_es.png"
                alt="Cambiar idioma" class="lang-img">
        </div>
        <!-- Filtro -->
        <div class="filter-bar" id="filter-bar">
            <button class="filter-btn" data-filter="all">
                <span
                    style="pointer-events: none;margin:0;font-family: 'Jersey 10';font-weight: lighter;font-size: 3em;">ALL</span>
            </button>
            <button class="filter-btn" data-filter="shop">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/shop_door.png"
                    alt="Shop">
            </button>
            <button class="filter-btn" data-filter="itemroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/itemroom_door.png"
                    alt="Item Room">
            </button>
            <button class="filter-btn" data-filter="planetarium">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/planetarium_door.png"
                    alt="Planetarium">
            </button>
            <button class="filter-btn" data-filter="library">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/library_door.png"
                    alt="Library">
            </button>
            <button class="filter-btn" data-filter="curseroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/curseroom_door.png"
                    alt="Curse Room">
            </button>
            <button class="filter-btn" data-filter="secretroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/secretroom_door.png"
                    alt="Secret Room">
            </button>
            <button class="filter-btn" data-filter="bossroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/bossroom_door.png"
                    alt="Boss Room">
            </button>
            <button class="filter-btn" data-filter="devilroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/devilroom_door.png"
                    alt="Devil Room">
            </button>
            <button class="filter-btn" data-filter="angelroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/angelroom_door.png"
                    alt="Angel Room">
            </button>
            <button class="filter-btn" data-filter="trinkets">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/trinkets.png"
                    alt="Trinkets">
            </button>
            <button class="filter-btn" data-filter="consumibles">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/consumibles.png"
                    alt="Consumibles">
            </button>
        </div>
        <div id="items-header">
            <button id="sort-id-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/id.png"
                    alt="Ordenar por ID">
            </button>
            <h2 id="h2-items" style="margin:0;">ITEMS</h2>
            <button id="sort-color-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/color.png"
                    alt="Ordenar por Color">
            </button>
        </div>
        <div id="items" class="img-grid itemgrid"></div>
        <div id="trinkets-header">
            <button id="sort-id-trinkets-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/id.png"
                    alt="Ordenar por ID">
            </button>
            <h2 id="h2-trinkets">TRINKETS</h2>
            <button id="sort-color-trinkets-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/color.png"
                    alt="Ordenar por Color">
            </button>
        </div>
        <div id="trinkets" class="img-grid trinketgrid"></div>
        <h2 id="h2-cards">MISC</h2>
        <div id="cards" class="img-grid cardgrid"></div>
    </div>
    <!-- Mensaje de error -->
    <div id="error-msg" style="color:red; margin:1em 0;"></div>
    <!-- Modals -->
    <div id="item-modal" class="modal">
        <div class="modal-content" id="modal-content-item">
            <span class="modal-close" id="modal-close-item">&times;</span>
            <!-- Info del item aquí -->
        </div>
    </div>
    <div id="trinket-modal" class="modal">
        <div class="modal-content" id="modal-content-trinket">
            <span class="modal-close" id="modal-close-trinket">&times;</span>
            <!-- Info del trinket aquí -->
        </div>
    </div>
    <div id="card-modal" class="modal">
        <div class="modal-content" id="modal-content-card">
            <span class="modal-close" id="modal-close-card">&times;</span>
            <!-- Info de la card aquí -->
        </div>
    </div>

    <div id="info-modal_es" class="modal">
        <div class="modal-content" id="modal-content-info">
            <span class="modal-close" id="modal-close-info">&times;</span>
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;"><img
                    src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png"
                    style="pointer-events: none;">
                <h3>Joker Card</h3><img
                    src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png"
                    style="pointer-events: none;">
            </div>
            <p>Esta es una aplicación web para consultar rápidamente información sobre los objetos de The Binding of
                Isaac</p>
            <p>Puedes usar los filtros de la parte superior para mostrar objetos de habitaciones específicas, o usar la
                barra de búsqueda para encontrar objetos por nombre o descripción.</p>
            <p>Haz clic en cualquier objeto para ver su información detallada.</p>
            <p>El botón de idioma en la esquina superior derecha permite cambiar entre español e inglés.</p>
            <img style="width: 75%;border-radius: 20px; border:pink inset 10px; display: block; margin: 0 auto; pointer-events: none;"
                src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/kokomiLogo.png">
            <p>Esta página ha sido desarrollada especificamente para cubrir las necesidades de mi novia y asegurarme de
                que en su camino al platinum god se lo pase lo mejor posible</p>
            <p>Todo aquel que la use sabrá que esto va por ti 💜👀</p>
            <p>P.D. ya descubriras lo que es el platinum god</p>
        </div>
    </div>
    <div id="info-modal_en" class="modal">
        <div class="modal-content" id="modal-content-info">
            <span class="modal-close" id="modal-close-info">&times;</span>
            <div style="display: flex; align-items: center; justify-content: center, gap: 10px;"><img
                    src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png">
                <h3>Joker Card</h3><img
                    src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png">
            </div>
            <p>This is a web application to quickly consult information about items in The Binding of Isaac</p>
            <p>You can use the filters at the top to show items from specific rooms, or use the search bar to find items
                by name or description.</p>
            <p>Click on any item to see its detailed information.</p>
            <p>The language button in the top right corner allows you to switch between Spanish and English.</p>
            <img style="width: 75%;border-radius: 20px; border:pink inset 10px; display: block; margin: 0 auto;"
                src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/kokomiLogo.png">
            <p>This page has been developed specifically to meet my girlfriend's needs and ensure that she enjoys her
                journey to platinum god as much as possible</p>
            <p>Anyone who uses it will know that this is for you 💜👀</p>
            <p>P.S. you'll find out what platinum god is</p>
        </div>

        <script>
            clearAllGrids(); // Limpia los grids al inicio
            const baseUrl = "https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/";

            // Variables para almacenar los datos
            let allItems = [];
            let allTrinkets = [];
            let allCards = [];

            // Estado de orden actual (mover estas declaraciones aquí arriba)
            let sortMode = "id";
            let sortModeTrinkets = "id";

            let language = 'es'; // Por defecto español

            // Helper para crear imágenes y eventos
            function createImg(src, alt, clickHandler) {
                const img = document.createElement('img');
                img.src = src;
                img.alt = alt;
                img.style.objectFit = "contain";
                img.onerror = function () { this.style.display = 'none'; };
                img.addEventListener('click', clickHandler);
                return img;
            }

            function initializeButtonStates() {
                // Activar botones de ID al inicio
                document.getElementById('sort-id-btn').classList.add('active');
                document.getElementById('sort-id-trinkets-btn').classList.add('active');
                // Asegurar que los botones de color estén desactivados
                document.getElementById('sort-color-btn').classList.remove('active');
                document.getElementById('sort-color-trinkets-btn').classList.remove('active');
            }

            function preloadAllImages() {
                const baseUrl = "https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/";
                // Items
                allItems.forEach(item => {
                    if (item.id) {
                        const img = new Image();
                        img.src = `${baseUrl}All_Items/item_${item.id}.png`;
                    }
                });
                // Trinkets
                allTrinkets.forEach(trinket => {
                    if (trinket.trinketId) {
                        const img = new Image();
                        img.src = `${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png`;
                    }
                });
                // Cards
                allCards.forEach(card => {
                    if (card.cardId) {
                        const img = new Image();
                        img.src = `${baseUrl}All_Consumables/card_${card.cardId}.png`;
                    }
                });
            }

            // Modificar la función loadAllData para llamar a initializeButtonStates
            function loadAllData() {
                // Limpia los arrays antes de cargar
                allItems = [];
                allTrinkets = [];
                allCards = [];
                clearAllGrids();

                // Restablecer el estado de ordenamiento por defecto
                sortMode = "id";
                sortModeTrinkets = "id";
                initializeButtonStates();

                fetch(`${baseUrl}items_${language}.json`)
                    .then(res => {
                        return res.json();
                    })
                    .then(items => { allItems = items; renderByFilters(); preloadAllImages(); })
                    .catch(err => {
                    });

                fetch(`${baseUrl}trinkets_${language}.json`)
                    .then(res => {
                        return res.json();
                    })
                    .then(trinkets => { allTrinkets = trinkets; renderByFilters(); preloadAllImages(); })
                    .catch(err => {
                    });

                fetch(`${baseUrl}cards_${language}.json`)
                    .then(res => {
                        return res.json();
                    })
                    .then(cards => { allCards = cards; renderByFilters(); preloadAllImages(); })
                    .catch(err => {
                    });
            }

            // Inicializa con español
            loadAllData();

            // Filtros activos
            let activeFilters = [];

            // Limpia todos los grids y oculta los h2
            function clearAllGrids() {
                document.getElementById('items').innerHTML = '';
                document.getElementById('trinkets').innerHTML = '';
                document.getElementById('cards').innerHTML = '';
                document.getElementById('items-header').style.display = 'none';
                document.getElementById('trinkets-header').style.display = 'none';
                document.getElementById('h2-cards').style.display = 'none';
            }

            // Search logic
            document.getElementById('search-bar').addEventListener('input', function (e) {
                window.searchText = e.target.value.trim().toLowerCase();
                // Si no hay filtros activos y hay texto, activa "all"
                if (window.searchText && activeFilters.length === 0) {
                    activeFilters = ['all'];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
                }
                renderByFilters();
            });
            window.searchText = "";
            const searchInput = document.getElementById('search-bar');
            const clearButton = document.getElementById('clear-search');

            searchInput.addEventListener('input', function () {
                clearButton.style.display = this.value ? 'block' : 'none';
            });

            clearButton.addEventListener('click', function () {
                const html = document.documentElement;
                const items = document.querySelectorAll('.img-grid img');
                searchInput.value = '';
                window.searchText = '';
                this.style.display = 'none';
                html.classList.remove('rainbow-effect');
                items.forEach(img => img.classList.remove('rainbow-effect'));
                renderByFilters();
            });

            // Renderiza según los filtros activos
            function renderByFilters() {
                clearAllGrids();
                let showItems = [];
                let showTrinkets = [];
                let showCards = [];

                // Filtrado por filtros
                if (activeFilters.length === 0) {
                    // Nada seleccionado, no mostrar nada
                } else if (activeFilters.includes('all')) {
                    showItems = allItems;
                    showTrinkets = allTrinkets;
                    showCards = allCards;
                } else {
                    const pools = {
                        shop: 'Shop',
                        itemroom: 'Item Room',
                        bossroom: 'Boss Room',
                        devilroom: 'Devil Room',
                        angelroom: 'Angel Room',
                        curseroom: 'Curse Room',
                        secretroom: 'Secret Room',
                        library: 'Library',
                        planetarium: 'Planetarium'
                    };
                    let itemFilters = Object.keys(pools).filter(f => activeFilters.includes(f));
                    if (itemFilters.length > 0) {
                        showItems = allItems.filter(i =>
                            i.item_pool && itemFilters.some(f =>
                                i.item_pool.some(poolStr =>
                                    poolStr && poolStr.toLowerCase().includes(pools[f].toLowerCase())
                                )
                            )
                        );
                    }
                    if (activeFilters.includes('trinkets')) showTrinkets = allTrinkets;
                    if (activeFilters.includes('consumibles')) showCards = allCards;
                }

                // Filtrado por search
                if (window.searchText && window.searchText !== 'rainbow') {
                    const matchesText = obj => {
                        return Object.values(obj).some(val => {
                            if (!val) return false;
                            if (typeof val === 'string') return val.toLowerCase().includes(window.searchText);
                            if (typeof val === 'number') return val.toString().includes(window.searchText);
                            if (Array.isArray(val)) return val.join(' ').toLowerCase().includes(window.searchText);
                            return false;
                        });
                    };
                    showItems = showItems.filter(matchesText);
                    showTrinkets = showTrinkets.filter(matchesText);
                    showCards = showCards.filter(matchesText);
                }

                // Render y manejo de clases active
                const itemsGrid = document.getElementById('items');
                const trinketsGrid = document.getElementById('trinkets');
                const cardsGrid = document.getElementById('cards');

                if (showItems.length > 0) {
                    renderItems(showItems);
                    itemsGrid.classList.add('active');
                } else {
                    itemsGrid.classList.remove('active');
                }

                if (showTrinkets.length > 0) {
                    renderTrinkets(showTrinkets);
                    trinketsGrid.classList.add('active');
                } else {
                    trinketsGrid.classList.remove('active');
                }

                if (showCards.length > 0) {
                    renderCards(showCards);
                    cardsGrid.classList.add('active');
                } else {
                    cardsGrid.classList.remove('active');
                }

                document.getElementById('items-header').style.display = document.getElementById('items').children.length ? '' : 'none';
                document.getElementById('trinkets-header').style.display = document.getElementById('trinkets').children.length ? '' : 'none';
                document.getElementById('h2-cards').style.display = document.getElementById('cards').children.length ? '' : 'none';
            }

            function renderCards(cards) {
                const container = document.getElementById('cards');
                container.innerHTML = '';
                cards.forEach(card => {
                    if (!card.cardId) return;
                    const img = createImg(
                        `${baseUrl}All_Consumables/card_${card.cardId}.png`,
                        card.name,
                        () => showCardModal(card)
                    );
                    let wrap = document.createElement('div');
                    wrap.className = 'img-wrap';
                    wrap.appendChild(img);
                    container.appendChild(wrap);
                });
            }

            // Filtros: stackeables, "All" es exclusivo
            document.getElementById('filter-bar').addEventListener('click', function (e) {
                if (!e.target.classList.contains('filter-btn')) return;
                const filter = e.target.dataset.filter;

                // Si el botón ya está activo, desactivarlo
                if (activeFilters.includes(filter)) {
                    activeFilters = [];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                } else {
                    // Desactivar todos los botones y activar solo el nuevo
                    activeFilters = [filter];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }

                renderByFilters();
            });

            // MODALS
            // Item modal
            const itemModal = document.getElementById('item-modal');
            const itemModalContent = document.getElementById('modal-content-item');
            function showItemModal(item) {
                let catImg = '';
                if (item.cat === 'up' || item.cat === 'up2' || item.cat === 'down') {
                    catImg = `<img src="${baseUrl}cat_${item.cat}.png" alt="cat_${item.cat}" class="cat-corner">`;
                }
                let rechargeImg = '';
                if (item.recharge_time && Array.isArray(item.recharge_time)) {
                    const validNumbers = ['1', '2', '3', '4', '6', '12'];
                    const firstValue = item.recharge_time[0];
                    if (firstValue) {
                        // Extrae el número al principio del string
                        const match = firstValue.match(/^(\d+)/);
                        if (match && validNumbers.includes(match[1])) {
                            rechargeImg = `<img src="${baseUrl}bars/${match[1]}.png" alt="recharge_${match[1]}" style="margin-left:10px;pointer-events: none;">`;
                        }
                    }
                }
                // Encontrar el índice actual y comprobar si hay anterior/siguiente
                const currentIndex = allItems.findIndex(i => i.id === item.id);
                const prevItem = currentIndex > 0 ? allItems[currentIndex - 1] : null;
                const nextItem = currentIndex < allItems.length - 1 ? allItems[currentIndex + 1] : null;
                itemModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-item">&times;</span>
                ${prevItem ? `<div class="modal-nav modal-prev" onclick="showItemModal(allItems[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextItem ? `<div class="modal-nav modal-next" onclick="showItemModal(allItems[${currentIndex + 1}])">&gt;</div>` : ''}
                <div style="position:relative;display:flex;align-items:center;justify-content:center;">
                    <img src="${baseUrl}All_Items/item_${item.id}.png" alt="${item.name}" style="width:100px;height:100px;display:block;object-fit: contain;pointer-events: none;">
                    ${rechargeImg}
                </div>
                ${catImg}
                <h3>${item.name}</h3>
                ${item.pickup ? `<h3>"${item.pickup}"</h3>` : ''}
                <p>${Array.isArray(item.description) ? item.description.join('<br><br>') : item.description || ''}</p>
                ${item.recharge_time ? `<p><i><strong>USOS:</strong></i> ${item.recharge_time}</p>` : ''}
                <p><i><strong>TIPO:</strong></i> ${item.type_list ? item.type_list.join(', ') : ''}</p>
                ${item.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${item.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${item.id}</p>
            `;
                itemModal.style.display = 'flex';
                document.getElementById('modal-close-item').onclick = () => { itemModal.style.display = 'none'; };
            }
            itemModal.onclick = function (e) {
                if (e.target === itemModal) itemModal.style.display = 'none';
            };

            // Trinket modal
            const trinketModal = document.getElementById('trinket-modal');
            const trinketModalContent = document.getElementById('modal-content-trinket');
            function showTrinketModal(trinket) {
                let catImg = '';
                if (trinket.cat === 'up' || trinket.cat === 'down') {
                    catImg = `<img src="${baseUrl}cat_${trinket.cat}.png" alt="cat_${trinket.cat}" class="cat-corner">`;
                }

                // Encontrar el índice actual y comprobar si hay anterior/siguiente
                const currentIndex = allTrinkets.findIndex(t => t.trinketId === trinket.trinketId);
                const prevTrinket = currentIndex > 0 ? allTrinkets[currentIndex - 1] : null;
                const nextTrinket = currentIndex < allTrinkets.length - 1 ? allTrinkets[currentIndex + 1] : null;

                trinketModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-trinket">&times;</span>
                ${prevTrinket ? `<div class="modal-nav modal-prev" onclick="showTrinketModal(allTrinkets[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextTrinket ? `<div class="modal-nav modal-next" onclick="showTrinketModal(allTrinkets[${currentIndex + 1}])">&gt;</div>` : ''}
                <img src="${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png" alt="${trinket.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;pointer-events: none;">
                ${catImg}
                <h3>${trinket.name}</h3>
                ${trinket.pickup ? `<h3>"${trinket.pickup}"</h3>` : ''}
                <p>${Array.isArray(trinket.description) ? trinket.description.join('<br><br>') : trinket.description || ''}</p>
                ${trinket.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${trinket.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${trinket.trinketId}</p>
            `;
                trinketModal.style.display = 'flex';
                document.getElementById('modal-close-trinket').onclick = () => { trinketModal.style.display = 'none'; };
            }
            trinketModal.onclick = function (e) {
                if (e.target === trinketModal) trinketModal.style.display = 'none';
            };

            // Card modal
            const cardModal = document.getElementById('card-modal');
            const cardModalContent = document.getElementById('modal-content-card');
            function showCardModal(card) {
                let catImg = '';
                if (card.cat === 'up' || card.cat === 'down') {
                    catImg = `<img src="${baseUrl}cat_${card.cat}.png" alt="cat_${card.cat}" class="cat-corner">`;
                }

                // Encontrar el índice actual y comprobar si hay anterior/siguiente
                const currentIndex = allCards.findIndex(c => c.cardId === card.cardId);
                const prevCard = currentIndex > 0 ? allCards[currentIndex - 1] : null;
                const nextCard = currentIndex < allCards.length - 1 ? allCards[currentIndex + 1] : null;

                let description;
                if (card.cardId == 114) {
                    description = card.description;
                } else {
                    description = Array.isArray(card.description) ? card.description.join('<br><br>') : card.description || '';
                }

                cardModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-card">&times;</span>
                ${prevCard ? `<div class="modal-nav modal-prev" onclick="showCardModal(allCards[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextCard ? `<div class="modal-nav modal-next" onclick="showCardModal(allCards[${currentIndex + 1}])">&gt;</div>` : ''}
                <img src="${baseUrl}All_Consumables/card_${card.cardId}.png" alt="${card.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;pointer-events: none;">
                ${catImg}
                <h3>${card.name}</h3>
                ${card.pickup ? `<h3>"${card.pickup}"</h3>` : ''}
                <p>${description}</p>
                ${card.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${card.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${card.cardId}</p>
            `;
                cardModal.style.display = 'flex';
                document.getElementById('modal-close-card').onclick = () => { cardModal.style.display = 'none'; };
            }
            cardModal.onclick = function (e) {
                if (e.target === cardModal) cardModal.style.display = 'none';
            };

            // Info modal
            document.getElementById('info-btn').addEventListener('click', function () {
                let infoModal;
                if (language === 'es') {
                    infoModal = document.getElementById('info-modal_es');
                } else {
                    infoModal = document.getElementById('info-modal_en');
                }
                infoModal.style.display = 'flex';

                const closeBtn = infoModal.querySelector('.modal-close');
                closeBtn.onclick = () => {
                    infoModal.style.display = 'none';
                };

                infoModal.onclick = function (e) {
                    if (e.target === infoModal) infoModal.style.display = 'none';
                };
            });

            // Lista de colores en orden cromático
            const colorOrder = [
                "white", "silver", "grey", "gray", "black", "brown", "red", "orange", "gold",
                "yellow", "green", "cyan", "blue", "purple", "pink"
            ];

            // Función para extraer colores de tags
            function getItemColors(item) {
                if (!item.tags) return [];
                const tagsArr = item.tags.split(',').map(t => t.trim().toLowerCase());
                // Devuelve los colores en el orden en que aparecen en los tags
                return tagsArr.filter(tag => colorOrder.includes(tag));
            }

            // Ordena los items por color principal y secundarios
            function sortItemsByColor(items) {
                return items.slice().sort((a, b) => {
                    const aColors = getItemColors(a);
                    const bColors = getItemColors(b);

                    // Si ninguno tiene color, van al final
                    if (aColors.length === 0 && bColors.length === 0) return 0;
                    if (aColors.length === 0) return 1;
                    if (bColors.length === 0) return -1;

                    // Orden por color principal
                    const aMain = colorOrder.findIndex(c => c === aColors[0]);
                    const bMain = colorOrder.findIndex(c => c === bColors[0]);
                    if (aMain !== bMain) return aMain - bMain;

                    // Si tienen el mismo color principal, compara secundarios
                    for (let i = 1; i < Math.max(aColors.length, bColors.length); i++) {
                        const aSec = aColors[i] ? colorOrder.findIndex(c => c === aColors[i]) : Infinity;
                        const bSec = bColors[i] ? colorOrder.findIndex(c => c === bColors[i]) : Infinity;
                        if (aSec !== bSec) return aSec - bSec;
                    }

                    // Si todo igual, por ID
                    return (a.id || 0) - (b.id || 0);
                });
            }

            // Ordena los items por ID
            function sortItemsById(items) {
                return items.slice().sort((a, b) => (a.id || 0) - (b.id || 0));
            }

            function sortTrinketsById(trinkets) {
                return trinkets.slice().sort((a, b) => (a.trinketId || 0) - (b.trinketId || 0));
            }

            function sortTrinketsByColor(trinkets) {
                return trinkets.slice().sort((a, b) => {
                    const aColors = getItemColors(a);
                    const bColors = getItemColors(b);

                    // Si ninguno tiene color, van al final
                    if (aColors.length === 0 && bColors.length === 0) return 0;
                    if (aColors.length === 0) return 1;
                    if (bColors.length === 0) return -1;

                    // Orden por color principal
                    const aMain = colorOrder.findIndex(c => c === aColors[0]);
                    const bMain = colorOrder.findIndex(c => c === bColors[0]);
                    if (aMain !== bMain) return aMain - bMain;

                    // Si todo igual, por ID
                    return (a.trinketId || 0) - (b.trinketId || 0);
                });
            }

            // Modifica renderItems para usar el modo de orden
            function renderItems(items) {
                const container = document.getElementById('items');
                container.innerHTML = '';
                let sortedItems = items;
                if (sortMode === "id") {
                    sortedItems = sortItemsById(items);
                } else if (sortMode === "color") {
                    sortedItems = sortItemsByColor(items);
                }
                sortedItems.forEach(item => {
                    if (!item.id) return;
                    const img = createImg(
                        `${baseUrl}All_Items/item_${item.id}.png`,
                        item.name,
                        () => showItemModal(item)
                    );
                    let wrap = document.createElement('div');
                    wrap.className = 'img-wrap';
                    if (item.cat === 'up' || item.cat === 'up2') wrap.classList.add('cat-up');
                    if (item.cat === 'down') wrap.classList.add('cat-down');
                    wrap.appendChild(img);
                    container.appendChild(wrap);
                });
            }

            function renderTrinkets(trinkets) {
                const container = document.getElementById('trinkets');
                container.innerHTML = '';
                let sortedTrinkets = trinkets;
                if (sortModeTrinkets === "id") {
                    sortedTrinkets = sortTrinketsById(trinkets);
                } else if (sortModeTrinkets === "color") {
                    sortedTrinkets = sortTrinketsByColor(trinkets);
                }
                sortedTrinkets.forEach(trinket => {
                    if (!trinket.trinketId) return;
                    const img = createImg(
                        `${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png`,
                        trinket.name,
                        () => showTrinketModal(trinket)
                    );
                    let wrap = document.createElement('div');
                    wrap.className = 'img-wrap';
                    wrap.appendChild(img);
                    container.appendChild(wrap);
                });
            }

            // Botones de ordenamiento para items
            document.getElementById('sort-id-btn').onclick = function () {
                const idBtn = document.getElementById('sort-id-btn');
                const colorBtn = document.getElementById('sort-color-btn');

                if (sortMode === "id") {
                    // Si ya está en modo ID, desactivar
                    sortMode = "default";
                    idBtn.classList.remove('active');
                } else {
                    // Activar modo ID y desactivar color
                    sortMode = "id";
                    idBtn.classList.add('active');
                    colorBtn.classList.remove('active');
                }
                renderByFilters();
            };

            document.getElementById('sort-color-btn').onclick = function () {
                const idBtn = document.getElementById('sort-id-btn');
                const colorBtn = document.getElementById('sort-color-btn');

                if (sortMode === "color") {
                    // Si ya está en modo color, desactivar
                    sortMode = "default";
                    colorBtn.classList.remove('active');
                } else {
                    // Activar modo color y desactivar ID
                    sortMode = "color";
                    colorBtn.classList.add('active');
                    idBtn.classList.remove('active');
                }
                renderByFilters();
            };

            // Botones de ordenamiento para trinkets
            document.getElementById('sort-id-trinkets-btn').onclick = function () {
                const idBtn = document.getElementById('sort-id-trinkets-btn');
                const colorBtn = document.getElementById('sort-color-trinkets-btn');

                if (sortModeTrinkets === "id") {
                    // Si ya está en modo ID, desactivar
                    sortModeTrinkets = "default";
                    idBtn.classList.remove('active');
                } else {
                    // Activar modo ID y desactivar color
                    sortModeTrinkets = "id";
                    idBtn.classList.add('active');
                    colorBtn.classList.remove('active');
                }
                renderByFilters();
            };

            document.getElementById('sort-color-trinkets-btn').onclick = function () {
                const idBtn = document.getElementById('sort-id-trinkets-btn');
                const colorBtn = document.getElementById('sort-color-trinkets-btn');

                if (sortModeTrinkets === "color") {
                    // Si ya está en modo color, desactivar
                    sortModeTrinkets = "default";
                    colorBtn.classList.remove('active');
                } else {
                    // Activar modo color y desactivar ID
                    sortModeTrinkets = "color";
                    colorBtn.classList.add('active');
                    idBtn.classList.remove('active');
                }
                renderByFilters();
            };

            // Toggle de idioma
            document.getElementById('lang-toggle').addEventListener('click', function () {
                language = (language === 'es') ? 'en' : 'es';
                this.src = `https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/languages_${language}.png`;
                document.getElementById('search-bar').placeholder =
                    (language === 'es') ? 'Nombre, habitación, etc...' : 'Name, room, etc...';
                loadAllData();
            });

            // Soporte para navegación con teclado
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    // Cerrar cualquier modal que esté abierto
                    if (itemModal.style.display === 'flex') itemModal.style.display = 'none';
                    if (trinketModal.style.display === 'flex') trinketModal.style.display = 'none';
                    if (cardModal.style.display === 'flex') cardModal.style.display = 'none';
                    if (document.getElementById('info-modal_es').style.display === 'flex') document.getElementById('info-modal_es').style.display = 'none';
                    if (document.getElementById('info-modal_en').style.display === 'flex') document.getElementById('info-modal_en').style.display = 'none';
                    return;
                }

                if (itemModal.style.display === 'flex') {
                    const currentImg = document.querySelector('#modal-content-item img[style*="width:100px"]');
                    const currentName = currentImg.alt;
                    const currentIndex = allItems.findIndex(i => i.name === currentName);
                    if (e.key === 'ArrowLeft' && currentIndex > 0) {
                        showItemModal(allItems[currentIndex - 1]);
                    } else if (e.key === 'ArrowRight' && currentIndex < allItems.length - 1) {
                        showItemModal(allItems[currentIndex + 1]);
                    }
                } else if (trinketModal.style.display === 'flex') {
                    const currentImg = document.querySelector('#modal-content-trinket img[style*="width:100px"]');
                    const currentName = currentImg.alt;
                    const currentIndex = allTrinkets.findIndex(t => t.name === currentName);
                    if (e.key === 'ArrowLeft' && currentIndex > 0) {
                        showTrinketModal(allTrinkets[currentIndex - 1]);
                    } else if (e.key === 'ArrowRight' && currentIndex < allTrinkets.length - 1) {
                        showTrinketModal(allTrinkets[currentIndex + 1]);
                    }
                } else if (cardModal.style.display === 'flex') {
                    const currentImg = document.querySelector('#modal-content-card img[style*="width:100px"]');
                    const currentName = currentImg.alt;
                    const currentIndex = allCards.findIndex(c => c.name === currentName);
                    if (e.key === 'ArrowLeft' && currentIndex > 0) {
                        showCardModal(allCards[currentIndex - 1]);
                    } else if (e.key === 'ArrowRight' && currentIndex < allCards.length - 1) {
                        showCardModal(allCards[currentIndex + 1]);
                    }
                }
            });

            let tapCount = 0;
            let lastTapTime = 0;
            document.documentElement.addEventListener('click', function (e) {
                // Evita que cuente clics dentro de modals o grids
                if (
                    e.target.closest('.modal') ||
                    e.target.closest('.img-grid') ||
                    e.target.closest('.filter-bar') ||
                    e.target.closest('.search-bar-content')
                ) return;

                const now = Date.now();
                if (now - lastTapTime < 500) {
                    tapCount++;
                } else {
                    tapCount = 1;
                }
                lastTapTime = now;
                if (tapCount === 3) {
                    const isUp2 = Math.random() < 0.01;
                    const catSrc = isUp2
                        ? 'https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/cat_up2.png'
                        : 'https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/cat_up.png';
                    const cat = document.createElement('img');
                    cat.src = catSrc;
                    cat.className = 'blondigo-cat';
                    cat.style.position = 'fixed';
                    cat.style.left = '-120px';
                    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0);
                    cat.style.top = Math.floor(Math.random() * (vh - 120)) + 'px';
                    cat.style.width = '100px';
                    cat.style.height = '100px';
                    cat.style.zIndex = '9999';
                    cat.style.pointerEvents = 'none';
                    cat.style.opacity = '0';
                    cat.style.transition = 'opacity 0.3s, left 3s linear';
                    document.body.appendChild(cat);
                    setTimeout(() => { cat.style.opacity = '1'; cat.style.left = '110vw'; }, 100);
                    setTimeout(() => { cat.remove(); }, 3200);
                    tapCount = 0;
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                if (e.target.value.trim().toLowerCase() === 'chucurrucu') {
                    alert('Te quiero mucho Tania 💜');
                }
                if (e.target.value.trim().toLowerCase() === 'blondigo') {
                    alert('🐈 El blondigo estuvo aquí 🐈');
                }
                if (e.target.value.trim().toLowerCase() === 'carbonaro') {
                    alert('🐈 Si, el carbonaro también 🐈');
                }
                if (e.target.value.trim().toLowerCase() === 'plim') {
                    alert('PLIM PLIM PLOOOOOOOM');
                }
                if (e.target.value.trim().toLowerCase() === 'ellandecito') {
                    alert('Un besito?');
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();
                const html = document.documentElement;
                const items = document.querySelectorAll('.img-grid img');
                if (val === 'rainbow') {
                    html.classList.add('rainbow-effect');
                    items.forEach(img => img.classList.add('rainbow-effect'));
                } else {
                    html.classList.remove('rainbow-effect');
                    items.forEach(img => img.classList.remove('rainbow-effect'));
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Eliminar láser existente
                document.querySelectorAll('.brimstone-laser').forEach(el => el.remove());

                if (val === 'brimstone') {
                    // Encontrar el elemento Brimstone en la página
                    const brimstoneImg = Array.from(document.querySelectorAll('.img-grid img'))
                        .find(img => img.src.includes('item_118.png'));
                    if (!brimstoneImg) return;

                    // Obtener la posición del item
                    const rect = brimstoneImg.getBoundingClientRect();
                    const startX = rect.left + (rect.width / 2);
                    const startY = rect.top + (rect.height / 1);

                    const laser = document.createElement('div');
                    laser.className = 'brimstone-laser';
                    laser.style.position = 'fixed';
                    laser.style.top = startY + 'px';
                    laser.style.left = startX + 'px';
                    laser.style.transformOrigin = 'top center';
                    laser.style.transform = 'translateX(-50%)';
                    laser.style.width = '40px';
                    laser.style.height = '200vh';
                    laser.style.background = 'repeating-linear-gradient(45deg, #ff0000, #ff0000 10px, #a10000 10px, #a10000 20px)';
                    laser.style.backgroundSize = '28px 28px';
                    laser.style.animation = 'laserFlow 0.8s linear infinite';
                    laser.style.boxShadow = '0 0 20px #ff0000';
                    laser.style.zIndex = '9999';
                    laser.style.borderRadius = '20px 20px 0 0'; // Bordes redondeados arriba


                    // Actualiza las animaciones keyframes
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes laserFlow {
                        0% { background-position: 0 0; }
                        100% { background-position: 0 300px; }
                    }
                    @keyframes laserShake {
                        0%, 100% { transform: translateX(-50%) rotate(0deg); }
                        25% { transform: translateX(-50%) rotate(0.3deg); }
                        75% { transform: translateX(-50%) rotate(-0.3deg); }
                    }
                `;
                    document.head.appendChild(style);

                    document.body.appendChild(laser);

                    // Añadir shake
                    setTimeout(() => {
                        laser.style.animation = 'laserFlow 0.8s linear infinite, laserShake 0.05s linear infinite';
                    }, 100);

                    // Animación de desaparición
                    setTimeout(() => {
                        laser.style.transition = 'width 400ms ease-in, opacity 400ms ease-in';
                        laser.style.width = '0px';
                        laser.style.opacity = '0';
                        keepBrimstone = false;
                        brimstoneImg.style.filter = '';
                        clearInterval(interval);

                        setTimeout(() => {
                            laser.remove();
                            style.remove();
                        }, 400);
                    }, 3500);
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos infernales previos
                document.querySelectorAll('.brimstone-effect').forEach(el => el.remove());

                if (val === 'brimstone') {
                    // Encontrar el item Brimstone en la página
                    const brimstoneImg = Array.from(document.querySelectorAll('.img-grid img'))
                        .find(img => img.src.includes('item_118.png'));
                    if (!brimstoneImg) return;

                    // Añadir brillo al item
                    brimstoneImg.style.transition = 'filter 0.3s';
                    let keepBrimstone = true;
                    const interval = setInterval(() => {
                        if (keepBrimstone && brimstoneImg) {
                            brimstoneImg.style.filter = 'brightness(5) drop-shadow(0 0 10px #ff0000) drop-shadow(0 0 20px #ff0000) drop-shadow(0 0 30px #ff0000)';
                        }
                    }, 100);

                    // Crear efecto infernal
                    const hell = document.createElement('div');
                    hell.className = 'brimstone-effect';
                    hell.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle at center, transparent 0%, rgba(64,0,0,0.6) 100%);
                    pointer-events: none;
                    z-index: 9998;
                    opacity: 0;
                    transition: opacity 1s;
                `;

                    // Crear partículas de fuego
                    for (let i = 0; i < 30; i++) {
                        const ember = document.createElement('div');
                        ember.style.cssText = `
                        position: absolute;
                        width: 5px;
                        height: 5px;
                        background: #ff3300;
                        border-radius: 50%;
                        animation: ember ${1 + Math.random() * 1}s infinite;
                    `;
                        ember.style.left = Math.random() * 100 + 'vw';
                        ember.style.bottom = -10 + 'px';
                        hell.appendChild(ember);
                    }

                    // Añadir keyframes para las partículas
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes ember {
                        0% { 
                            transform: translateY(0) scale(1);
                            opacity: 1;
                        }
                        100% { 
                            transform: translateY(-${Math.random() * 200 + 100}px) scale(0);
                            opacity: 0;
                        }
                    }
                `;
                    document.head.appendChild(style);

                    document.body.appendChild(hell);
                    requestAnimationFrame(() => hell.style.opacity = '1');

                    // Limpiar efecto después de que termine el láser
                    setTimeout(() => {
                        hell.style.opacity = '0';
                        setTimeout(() => {
                            hell.remove();
                            style.remove();
                        }, 1000);
                    }, 3500);
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos lunares previos
                document.querySelectorAll('.luna-effect').forEach(el => el.remove());

                if (val === 'luna') {
                    // Encontrar el item Luna en la página
                    const lunaImg = document.querySelector(`img[src$="item_589.png"]`);
                    if (!lunaImg) return;

                    // Añadir brillo al item
                    lunaImg.style.transition = 'filter 0.3s';
                    let keepLuna = true;
                    const interval = setInterval(() => {
                        if (keepLuna && lunaImg) {
                            lunaImg.style.filter = 'brightness(2.5) drop-shadow(0 0 15px #ffffff) drop-shadow(0 0 30px #4169E1)';
                        }
                    }, 100);

                    // Crear efecto de luna
                    const luna = document.createElement('div');
                    luna.className = 'luna-effect';
                    luna.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle at center, transparent 0%, rgba(0,0,32,0.6) 100%);
                    pointer-events: none;
                    z-index: 9998;
                    opacity: 0;
                    transition: opacity 1s;
                `;

                    // Crear estrellas
                    for (let i = 0; i < 50; i++) {
                        const star = document.createElement('div');
                        star.style.cssText = `
                        position: absolute;
                        width: 2px;
                        height: 2px;
                        background: white;
                        border-radius: 50%;
                        animation: twinkle ${1 + Math.random() * 2}s infinite alternate;
                    `;
                        star.style.left = Math.random() * 100 + 'vw';
                        star.style.top = Math.random() * 100 + 'vh';
                        luna.appendChild(star);
                    }

                    // Añadir keyframes para el parpadeo de estrellas
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes twinkle {
                        0% { opacity: 0.2; }
                        100% { opacity: 1; transform: scale(1.5); }
                    }
                `;
                    document.head.appendChild(style);

                    document.body.appendChild(luna);
                    requestAnimationFrame(() => luna.style.opacity = '1');

                    // Limpiar efecto después de 3.5 segundos
                    setTimeout(() => {
                        luna.style.opacity = '0';
                        lunaImg.style.filter = '';
                        setTimeout(() => {
                            luna.remove();
                            style.remove();
                        }, 1000);
                    }, 3500);
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos previos
                document.querySelectorAll('.milk-effect').forEach(el => el.remove());

                if (val === 'soy milk') {
                    // Encontrar Soy Milk en la página
                    const milkImg = document.querySelector(`img[src$="item_330.png"]`);
                    if (!milkImg) return;

                    // Brillo al item
                    milkImg.style.transition = 'filter 0.3s';
                    let keepMilk = true;
                    const interval = setInterval(() => {
                        if (keepMilk && milkImg) {
                            milkImg.style.filter = 'brightness(2.5) drop-shadow(0 0 15px #fff8dc) drop-shadow(0 0 30px #ffeb3b)';
                        }
                    }, 100);

                    // Crear efecto ambiente
                    const milk = document.createElement('div');
                    milk.className = 'milk-effect';
                    milk.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle at center, transparent 0%, rgba(255, 191, 3, 0.3) 100%);
                    pointer-events: none;
                    z-index: 9998;
                    opacity: 0;
                    transition: opacity 1s;
                `;

                    // Crear gotas grandes
                    for (let i = 0; i < 20; i++) {
                        const drop = document.createElement('div');
                        drop.style.cssText = `
                        position: absolute;
                        width: ${12 + Math.random() * 12}px;
                        height: ${26 + Math.random() * 16}px;
                        background: rgba(255, 205, 205, 0.8);
                        border-radius: 40% 40% 50% 50%;
                        filter: blur(1px);
                        animation: milkDrop ${1 + Math.random()}s linear infinite;
                    `;
                        drop.style.left = Math.random() * 100 + 'vw';
                        drop.style.top = -20 + 'px';
                        milk.appendChild(drop);
                    }

                    // Añadir keyframes para las gotas
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes milkDrop {
                        0% { 
                            transform: translateY(0) scaleY(1);
                            opacity: 0.9;
                        }
                        80% {
                            opacity: 0.9;
                        }
                        100% { 
                            transform: translateY(110vh) scaleY(1.2);
                            opacity: 0;
                        }
                    }
                `;
                    document.head.appendChild(style);

                    document.body.appendChild(milk);
                    requestAnimationFrame(() => milk.style.opacity = '1');

                    // Limpiar efecto
                    setTimeout(() => {
                        milk.style.opacity = '0';
                        milkImg.style.filter = '';
                        setTimeout(() => {
                            milk.remove();
                            style.remove();
                        }, 1000);
                    }, 3500);
                }
            });
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos previos
                document.querySelectorAll('.ipecac-effect').forEach(el => el.remove());

                if (val === 'ipecac') {
                    // Encontrar Ipecac en la página
                    const ipecacImg = document.querySelector(`img[src$="item_149.png"]`);
                    if (!ipecacImg) return;

                    // Brillo al item
                    ipecacImg.style.transition = 'filter 0.3s';
                    let keepIpecac = true;
                    const interval = setInterval(() => {
                        if (keepIpecac && ipecacImg) {
                            ipecacImg.style.filter = 'brightness(2.5) drop-shadow(0 0 15px #32CD32) drop-shadow(0 0 30px #00FF00)';
                        }
                    }, 100);

                    // Crear efecto ambiente tóxico
                    const toxic = document.createElement('div');
                    toxic.className = 'ipecac-effect';
                    toxic.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: radial-gradient(circle at center, transparent 0%, rgba(0,64,0,0.6) 100%);
                    pointer-events: none;
                    z-index: 9998;
                    opacity: 0;
                    transition: opacity 1s;
                `;

                    // Crear burbujas tóxicas
                    for (let i = 0; i < 30; i++) {
                        const bubble = document.createElement('div');
                        bubble.style.cssText = `
                        position: absolute;
                        width: ${4 + Math.random() * 8}px;
                        height: ${4 + Math.random() * 8}px;
                        background: #32CD32;
                        border-radius: 50%;
                        filter: blur(1px);
                        opacity: 0.6;
                        animation: float ${3 + Math.random() * 4}s infinite;
                    `;
                        bubble.style.left = Math.random() * 100 + 'vw';
                        bubble.style.top = Math.random() * 100 + 'vh';
                        toxic.appendChild(bubble);
                    }

                    // Función para crear explosiones
                    function createExplosion() {
                        const explosion = document.createElement('div');
                        explosion.style.cssText = `
                        position: absolute;
                        left: ${Math.random() * 100}vw;
                        top: ${Math.random() * 100}vh;
                        width: 10px;
                        height: 10px;
                        background: #32CD32;
                        border-radius: 50%;
                        filter: blur(2px);
                        animation: explode 1s ease-out forwards;
                    `;
                        toxic.appendChild(explosion);
                        setTimeout(() => explosion.remove(), 1000);
                    }

                    // Añadir keyframes para animaciones
                    const style = document.createElement('style');
                    style.textContent = `
                    @keyframes float {
                        0%, 100% { transform: translate(0, 0); }
                        50% { transform: translate(${-20 + Math.random() * 40}px, ${-20 + Math.random() * 40}px); }
                    }
                    @keyframes explode {
                        0% { 
                            transform: scale(1);
                            opacity: 1;
                        }
                        50% {
                            transform: scale(30);
                            opacity: 0.5;
                        }
                        100% { 
                            transform: scale(40);
                            opacity: 0;
                        }
                    }
                `;
                    document.head.appendChild(style);

                    document.body.appendChild(toxic);
                    requestAnimationFrame(() => toxic.style.opacity = '1');

                    // Crear explosiones periódicamente
                    const explosionInterval = setInterval(() => {
                        createExplosion();
                    }, 500);

                    // Limpiar efecto
                    setTimeout(() => {
                        clearInterval(explosionInterval);
                        toxic.style.opacity = '0';
                        ipecacImg.style.filter = '';
                        setTimeout(() => {
                            toxic.remove();
                            style.remove();
                        }, 1000);
                    }, 3500);
                }
            });
            // Añadir al evento input del search-bar
            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos previos
                document.querySelectorAll('.sacred-effect').forEach(el => el.remove());

                if (val === 'sacred heart') {
                    const sacredImg = document.querySelector(`img[src$="item_182.png"]`);
                    if (!sacredImg) return;

                    // Brillo al item
                    sacredImg.style.transition = 'filter 0.3s';
                    let keepSacred = true;
                    const interval = setInterval(() => {
                        if (keepSacred && sacredImg) {
                            sacredImg.style.filter = 'brightness(2.5) drop-shadow(0 0 15px #ff69b4) drop-shadow(0 0 30px #ff1493)';
                        }
                    }, 100);

                    // Crear efecto divino
                    const sacred = document.createElement('div');
                    sacred.className = 'sacred-effect';
                    sacred.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: radial-gradient(circle at center, transparent 0%, rgba(255,192,203,0.3) 100%);
                        pointer-events: none;
                        z-index: 9998;
                        opacity: 0;
                        transition: opacity 1s;
                    `;

                    // Crear rayos de luz
                    for (let i = 0; i < 12; i++) {
                        const ray = document.createElement('div');
                        const angle = (i * 30) % 360;
                        ray.style.cssText = `
                            position: absolute;
                            left: 50%;
                            top: 50%;
                            width: 2px;
                            height: 200vh;
                            background: linear-gradient(to top, transparent, rgba(255,192,203,0.6), transparent);
                            transform-origin: bottom center;
                            transform: rotate(${angle}deg);
                            animation: rayRotate 20s linear infinite;
                        `;
                        sacred.appendChild(ray);
                    }

                    // Crear corazones flotantes
                    for (let i = 0; i < 20; i++) {
                        const heart = document.createElement('div');
                        heart.innerHTML = '❤';
                        heart.style.cssText = `
                            position: absolute;
                            color: pink;
                            font-size: ${20 + Math.random() * 20}px;
                            opacity: ${0.3 + Math.random() * 0.7};
                            left: ${Math.random() * 100}vw;
                            top: ${Math.random() * 100}vh;
                            animation: floatHeart ${3 + Math.random() * 4}s ease-in-out infinite;
                        `;
                        sacred.appendChild(heart);
                    }

                    // Añadir keyframes
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes rayRotate {
                            from { transform: rotate(${Math.random() * 360}deg); }
                            to { transform: rotate(${360 + Math.random() * 360}deg); }
                        }
                        @keyframes floatHeart {
                            0%, 100% { transform: translate(0, 0); }
                            50% { transform: translate(${-30 + Math.random() * 60}px, ${-30 + Math.random() * 60}px); }
                        }
                    `;
                    document.head.appendChild(style);

                    document.body.appendChild(sacred);
                    requestAnimationFrame(() => sacred.style.opacity = '1');

                    // Limpiar efecto
                    setTimeout(() => {
                        sacred.style.opacity = '0';
                        sacredImg.style.filter = '';
                        setTimeout(() => {
                            sacred.remove();
                            style.remove();
                        }, 1000);
                    }, 3500);
                }
            });

            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos previos y restaurar estados
                const cleanup = () => {
                    document.querySelectorAll('.wavy-effect').forEach(el => el.remove());
                    document.body.style.filter = '';
                    document.body.style.transform = '';
                    document.querySelectorAll('*').forEach(el => {
                        el.style.transform = '';
                        el.style.filter = '';
                        el.style.transition = '';
                    });
                };

                if (val !== 'wavy cap') {
                    cleanup();
                    return;
                }

                const wavyImg = document.querySelector(`img[src$="item_582.png"]`);
                if (!wavyImg) return;

                // Efecto más intenso en el item
                wavyImg.style.filter = 'brightness(3) saturate(200%) drop-shadow(0 0 25px #9370DB) drop-shadow(0 0 50px #8A2BE2)';
                wavyImg.style.animation = 'pulse 0.5s infinite alternate';

                const wavy = document.createElement('div');
                wavy.className = 'wavy-effect';
                wavy.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    pointer-events: none;
                    z-index: 9998;
                    mix-blend-mode: screen;
                    opacity: 1;
                    animation: wavyBackground 4s infinite linear;
                `;

                // Más esporas y más variadas
                for (let i = 0; i < 50; i++) {
                    const spore = document.createElement('div');
                    const size = 4 + Math.random() * 12;
                    spore.style.cssText = `
                        position: absolute;
                        width: ${size}px;
                        height: ${size}px;
                        background: ${Math.random() > 0.5 ? '#9370DB' : '#8A2BE2'};
                        border-radius: 50%;
                        filter: blur(${1 + Math.random() * 3}px) brightness(${1 + Math.random()});
                        opacity: ${0.4 + Math.random() * 0.6};
                        animation: float ${3 + Math.random() * 7}s infinite ease-in-out;
                        box-shadow: 0 0 ${10 + Math.random() * 20}px ${Math.random() > 0.5 ? '#9370DB' : '#8A2BE2'};
                    `;
                    spore.style.left = Math.random() * 100 + 'vw';
                    spore.style.top = Math.random() * 100 + 'vh';
                    wavy.appendChild(spore);
                }

                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse {
                        0% { transform: scale(1); }
                        100% { transform: scale(1.2); }
                    }
                    @keyframes float {
                        0%, 100% { 
                            transform: translate(0, 0) rotate(0deg) scale(1); 
                        }
                        50% { 
                            transform: 
                                translate(${-100 + Math.random() * 200}px, ${-100 + Math.random() * 200}px)
                                rotate(${Math.random() * 720}deg)
                                scale(${1 + Math.random()});
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(wavy);

                let time = 0;
                const animate = () => {
                    time += 0.02;

                    // Distorsión extrema de la página
                    document.body.style.filter = `
                        saturate(${100 + Math.sin(time) * 50}%)
                    `;
                    document.documentElement.style.filter = `
                        blur(${Math.abs(Math.sin(time * 0.5))}px)
                    hue-rotate(${Math.sin(time * 0.7) * 360}deg)
                    `;

                    document.body.style.transform = `
                        perspective(${800 + Math.sin(time) * 200}px)
                        rotate3d(
                            ${Math.sin(time * 0.5) * 0.3},
                            ${Math.cos(time * 0.5) * 0.3},
                            ${Math.sin(time * 0.3) * 0.1},
                            ${Math.sin(time) * 5}deg
                        )
                        scale(${1 + Math.sin(time * 0.8) * 0.1})
                    `;

                    // Distorsión psicodélica de imágenes
                    document.querySelectorAll('.img-grid img').forEach((img, index) => {
                        img.style.transform = `
                            translate(
                                ${Math.sin(time * 2 + index) * 15}px,
                                ${Math.cos(time * 1.5 + index) * 15}px
                            )
                            rotate(${Math.sin(time + index) * 15}deg)
                            scale(${1 + Math.sin(time * 3 + index * 0.1) * 0.2})
                            skew(${Math.sin(time * 2) * 10}deg)
                        `;
                        img.style.filter = `
                            brightness(${1 + Math.sin(time * 2) * 0.3})
                            hue-rotate(${Math.sin(time * 0.7 + index) * 180}deg)
                        `;
                    });

                    // Efecto en textos
                    document.querySelectorAll('h2, h3, p').forEach((text, index) => {
                        text.style.transform = `
                            translate(
                                ${Math.sin(time * 2 + index) * 10}px,
                                ${Math.cos(time * 1.5 + index) * 8}px
                            )
                            rotate(${Math.sin(time + index) * 3}deg)
                            scale(${1 + Math.sin(time * 2) * 0.1})
                        `;
                        text.style.filter = `blur(${Math.abs(Math.sin(time * 0.5))}px)`;
                    });

                    if (wavy.isConnected && document.getElementById('search-bar').value.trim().toLowerCase() === 'wavy cap') {
                        requestAnimationFrame(animate);
                    } else {
                        cleanup();
                        style.remove();
                    }
                };

                requestAnimationFrame(animate);
            });
            // ...existing code...

            document.getElementById('search-bar').addEventListener('input', function (e) {
                const val = e.target.value.trim().toLowerCase();

                // Limpiar efectos previos
                document.querySelectorAll('.tazazel-portal-effect').forEach(el => el.remove());

                // Diccionario de personajes y sus imágenes
                const characters = {
                    "isaac": "isaac.png",
                    "tainted isaac": "isaac_t.png",
                    "magdalene": "magdalene.png",
                    "tainted magdalene": "magdalene_t.png",
                    "cain": "cain.png",
                    "tainted cain": "cain_t.png",
                    "judas": "judas.png",
                    "tainted judas": "judas_t.png",
                    "blue baby": "bluebaby.png",
                    "tainted blue baby": "bluebaby_t.png",
                    "eve": "eve.png",
                    "tainted eve": "eve_t.png",
                    "samson": "samson.png",
                    "tainted samson": "samson_t.png",
                    "azazel": "azazel.png",
                    "tainted azazel": "azazel_t.png",
                    "lazarus": "lazarus.png",
                    "tainted lazarus": "lazarus_t.png",
                    "eden": "eden.png",
                    "tainted eden": "eden_t.png",
                    "the lost": "thelost.png",
                    "tainted the lost": "thelost_t.png",
                    "lilith": "lilith.png",
                    "tainted lilith": "lilith_t.png",
                    "keeper": "keeper.png",
                    "tainted keeper": "keeper_t.png",
                    "apollyon": "apollyon.png",
                    "tainted apollyon": "apollyon_t.png",
                    "the forgotten": "theforgotten.png",
                    "tainted the forgotten": "theforgotten_t.png",
                    "bethany": "bethany.png",
                    "tainted bethany": "bethany_t.png",
                    "jacob and esau": "jacobandesau.png",
                    "tainted jacob": "jacobandesau_t.png"
                };

                // Si el input coincide con algún personaje, muestra el efecto
                if (characters[val]) {
                    // Fondo oscuro bloqueante
                    const effect = document.createElement('div');
                    effect.className = 'tazazel-portal-effect';
                    effect.style.cssText = `
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle at center, rgba(0,0,0,0.97) 0%, rgba(0,0,0,1) 100%);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1.2s;
            pointer-events: all;
        `;

                    // Portal giratorio
                    const portal = document.createElement('img');
                    portal.src = 'https://raw.githubusercontent.com/ellandeperez/jokercard/main/characters/portal.png';
                    portal.alt = 'Portal';
                    portal.style.cssText = `
            width:  100vw; height: 100vh;
            object-fit: contain;
            filter: drop-shadow(0 0 60px #000) brightness(1.2);
            position: absolute;
            opacity: 0;
            left: 50%; top: 50%;
            transform: translate(-50%, -50%) scale(0.7) rotate(0deg);
            transition: opacity 1.2s, transform 1.2s cubic-bezier(.68,-0.55,.27,1.55);
            z-index: 1;
            animation: portal-spin 2.5s linear infinite;
            pointer-events: none;
            image-rendering: pixelated;
        `;

                    // Luz central del portal (pulsante)
                    const portalLight = document.createElement('div');
                    portalLight.style.cssText = `
            position: absolute;
            left: 50%; top: 50%;
            width: 320px; height: 320px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(255,0,255,0.25) 0%, rgba(255,255,255,0.12) 60%, transparent 100%);
            filter: blur(18px);
            opacity: 0;
            z-index: 1;
            pointer-events: none;
            transition: opacity 1.2s;
            animation: portal-light-pulse 2s infinite alternate;
        `;

                    // Personaje iluminado
                    const characterImg = document.createElement('img');
                    characterImg.src = `https://raw.githubusercontent.com/ellandeperez/jokercard/main/characters/${characters[val]}`;
                    characterImg.alt = val;
                    characterImg.style.cssText = `
            width: 220px;
            height: 220px;
            object-fit: contain;
            filter: drop-shadow(0 0 60px #fff) drop-shadow(0 0 40px #ff00ff) brightness(2) saturate(1.5);
            position: absolute;
            left: 50%; top: 50%;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.1);
            transition: opacity 1.2s, transform 1.2s cubic-bezier(.68,-0.55,.27,1.55), filter 1.2s;
            z-index: 2;
            cursor: pointer;
            animation: azazel-pulse 1.2s infinite alternate;
            image-rendering: pixelated;
        `;

                    // Fantasma del personaje
                    const ghost = document.createElement('img');
                    ghost.src = 'https://raw.githubusercontent.com/ellandeperez/jokercard/main/characters/death.png';
                    ghost.alt = 'Ghost';
                    ghost.style.cssText = `
            width: 180px;
            height: 180px;
            object-fit: contain;
            position: absolute;
            left: 50%; top: 50%;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.7) translateY(0);
            z-index: 3;
            pointer-events: none;
            transition: opacity 0.8s, transform 2s cubic-bezier(.68,-0.55,.27,1.55);
            filter: drop-shadow(0 0 40px #fff);
            image-rendering: pixelated;
        `;

                    effect.appendChild(portalLight);
                    effect.appendChild(portal);
                    effect.appendChild(characterImg);
                    effect.appendChild(ghost);
                    document.body.appendChild(effect);

                    // Keyframes para portal, luz y pulso
                    const style = document.createElement('style');
                    style.textContent = `
            @keyframes portal-spin {
                0% { transform: translate(-50%, -50%) scale(0.7) rotate(0deg);}
                100% { transform: translate(-50%, -50%) scale(0.7) rotate(360deg);}
            }
            @keyframes portal-light-pulse {
                0% { opacity: 0.8; }
                100% { opacity: 1; }
            }
            @keyframes azazel-pulse {
                0% { filter: drop-shadow(0 0 60px #fff) drop-shadow(0 0 40px #ff00ff)}
                100% { filter: drop-shadow(0 0 80px #fff) drop-shadow(0 0 60px #ff00ff)}
            }
        `;
                    document.head.appendChild(style);

                    // Fade in fondo, portal y luz
                    setTimeout(() => {
                        effect.style.opacity = '1';
                        portal.style.opacity = '1';
                        portal.style.transform = 'translate(-50%, -50%) scale(1) rotate(0deg)';
                        portalLight.style.opacity = '1';
                    }, 100);

                    // Personaje aparece del centro con pulso
                    setTimeout(() => {
                        characterImg.style.opacity = '1';
                        characterImg.style.transform = 'translate(-50%, -50%) scale(1)';
                    }, 900);

                    // Solo se puede clicar el personaje
                    effect.addEventListener('click', function (ev) {
                        if (ev.target !== characterImg) {
                            ev.stopPropagation();
                            ev.preventDefault();
                        }
                    }, true);

                    // Al clicar el personaje: baja brillo/saturación y aparece fantasma
                    characterImg.addEventListener('click', function (ev) {
                        ev.stopPropagation();
                        characterImg.style.animation = '';
                        characterImg.style.transition = 'filter 1.2s, opacity 1.2s';
                        characterImg.style.filter = 'drop-shadow(0 0 10px #222) brightness(0.6) saturate(0.5)';
                        portalLight.style.opacity = '0.3';
                        portal.style.opacity = '0';

                        // Fantasma aparece y sube
                        setTimeout(() => {
                            ghost.style.opacity = '1';
                            ghost.style.transform = 'translate(-50%, -50%) scale(1) translateY(-120px)';
                        }, 700);

                        // Desaparece todo después de que el fantasma sube
                        setTimeout(() => {
                            ghost.style.opacity = '0';
                            effect.style.opacity = '0';
                            setTimeout(() => {
                                effect.remove();
                                style.remove();
                            }, 1200);
                        }, 2200);
                    });

                    // Limpiar efecto al cambiar el input
                    const cleanup = () => {
                        effect.style.opacity = '0';
                        portal.style.opacity = '0';
                        characterImg.style.opacity = '0';
                        portalLight.style.opacity = '0';
                        ghost.style.opacity = '0';
                        setTimeout(() => {
                            effect.remove();
                            style.remove();
                        }, 1200);
                    };

                    const inputHandler = function (ev) {
                        if (ev.target.value.trim().toLowerCase() !== val) {
                            cleanup();
                            document.getElementById('search-bar').removeEventListener('input', inputHandler);
                        }
                    };
                    document.getElementById('search-bar').addEventListener('input', inputHandler);
                }
            });
            (function preloadCharacterImages() {
                const baseUrl = 'https://raw.githubusercontent.com/ellandeperez/jokercard/main/characters/';
                const images = [
                    "isaac.png", "isaac_t.png", "magdalene.png", "magdalene_t.png",
                    "cain.png", "cain_t.png", "judas.png", "judas_t.png",
                    "bluebaby.png", "bluebaby_t.png", "eve.png", "eve_t.png",
                    "samson.png", "samson_t.png", "azazel.png", "azazel_t.png",
                    "lazarus.png", "lazarus_t.png", "eden.png", "eden_t.png",
                    "thelost.png", "thelost_t.png", "lilith.png", "lilith_t.png",
                    "keeper.png", "keeper_t.png", "apollyon.png", "apollyon_t.png",
                    "theforgotten.png", "theforgotten_t.png", "bethany.png", "bethany_t.png",
                    "jacobandesau.png", "jacobandesau_t.png", "portal.png", "death.png"
                ];
                images.forEach(img => {
                    const image = new Image();
                    image.src = baseUrl + img;
                });
            })();

            // ...existing code...
        </script>
</body>

</html>