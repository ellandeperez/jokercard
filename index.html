<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&family=Jersey+15&display=swap" rel="stylesheet">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>Joker Card</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon.png" type="image/x-icon">
    <style>
        /* Webkit (Chrome, Edge, Safari) */
        ::-webkit-scrollbar {
            width: 0;
        }
        html{
            background-color: black;
            background-image: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/background.png');
            background-repeat: repeat-y;
            background-size: contain;
            background-position: center;
            min-height: 100vh;
            width: 100vw;
            box-sizing: border-box;
            overflow-x: hidden;
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/hover.cur'), auto !important;
        }
        img, .clear-search, button, .modal-close, .modal-nav{
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/cursor.cur'), auto !important;
        }
        input{
            cursor: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/write.cur'), auto !important;
        }
        body { 
            font-family: 'Jersey 15';font-weight: lighter;
            margin: 0;
        }
        .content {
            width: 75%;
            margin: 30px auto; /* Centra el contenido */
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 10px;
        }
        .itemgrid, .trinketgrid, .cardgrid {
            border-radius: 20px;
            padding: 10px 0px;
        }
        .itemgrid {
            background: rgba(255, 255, 0, 0.08);
        }
        .trinketgrid {
            background: rgba(128, 128, 128, 0.12);
        }
        .cardgrid {
            background: rgba(165, 104, 42, 0.15);
        }
        h2 { color: rgb(240, 234, 234); text-align: center; font-family: 'Jersey 15';margin: 0 0; text-shadow: rgb(18, 13, 13) 5px 5px 0px, rgb(0, 0, 0) 0px 0px 10px;font-size: 5em;letter-spacing: 5px;}
        h3{text-align:center;margin:0;font-family: 'Jersey 15';font-weight: lighter;font-size: 2em;}
        p{font-size: 1.5em;}
        .img-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px; /* Menor separaci칩n */
            align-items: flex-end;   /* Alinea arriba */
            justify-content: center; /* Centra horizontalmente */
            margin: 0px auto; /* Centra el grid en la pantalla */
        }
        .img-grid img {
            image-rendering: pixelated;
            display: block;
            margin: 0;
            transition: all 0.2s;
            z-index: 1;
            cursor: pointer;
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .img-grid img:hover {
            image-rendering: pixelated;
            transform: scale(1.5);
            z-index: 1000;
            filter:drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 10px #ff0000);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            border: 10px inset #99866e;
            background: #f6d6b0;
            padding: 1em 4em;
            border-radius: 8px;
            min-width: 200px;
            max-width: 550px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-content img {
            image-rendering: pixelated;
        }
        .modal-close {
            position: absolute;
            right: 1em;
            top: 1em;
            cursor: pointer;
            font-size: 2em;
        }
        .search-bar-content{
            width:100%;
            display:flex;
            justify-content:center;
            margin-bottom:10px;
        }
        .search-bar {
            margin-top: 5px;
            width:94%;
            padding:10px 30px 10px 10px;  /* Agregado padding-right para dar espacio a la x */
            font-size:2em;
            border-radius:8px;
            border:4px inset #99866e;
            background:#f6d6b0;
            color:#222;
            font-family: 'Jersey 15', Arial, sans-serif;
        }
        .search-bar-container {
            position: relative;
            width: 65%;
        }

        .clear-search {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 3em;
            color: #614e3c;
            display: none;
            user-select: none;
            padding: 5px;
        }

        .clear-search:hover {
            color: #000000;
        }
        .lang-img {
            padding:5px;
            margin-top: 5px;
            margin-left: 10px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        .info-img {
            padding:5px;
            margin-top: 5px;
            margin-right: 10px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            image-rendering: pixelated;
        }
        .filter-bar {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10;
            display: flex;
            gap: 5px;
            padding: 10px;
            justify-content: center;
            border-radius: 10px;
        }
        .filter-btn {
            font-family: 'Jersey 15', Arial, sans-serif;
            font-size: 1.2em;
            padding: 0; /* Elimina padding para que la imagen ocupe todo el bot칩n */
            padding-bottom: 4px;
            border-radius: 10px;
            border: outset 3px #99866e;
            background: #99866e;
            color: #222;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            outline: none;
            width: 100px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .filter-btn img {
            width: 95%;
            height: 95%;
            object-fit: contain;
            pointer-events: none; /* Permite que el click pase al bot칩n */
            display: block;
            image-rendering: pixelated;
            filter: brightness(75%) saturate(0.25);
            
        }
        .filter-btn.active {
            background: #f6d6b0;
            font-weight: bold;
            box-shadow: 0 0 8px #fff2;
        }
        .filter-btn.active img{
            filter: brightness(100%) saturate(100%);
        }
        .cat-corner {
            position: absolute;
            top: 1em;
            left: 1em;
            width: 125px;
            height: 125px;
            z-index: 10;
            pointer-events: none;
            filter:drop-shadow(0 0 5px #000000);
        }
        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 5em;
            color: #614e3c;
            cursor: pointer;
            padding: 0px;
            text-shadow: 2px 2px 2px rgba(0,0,0,0.5);
            transition: color 0.2s;
            user-select: none;
        }

        .modal-nav:hover {
            color: #000000;
        }

        .modal-prev {
            left: 10px;
        }

        .modal-next {
            right: 10px;
        }
        #items-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        #items-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }
        #items-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        #trinkets-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
        }
        #trinkets-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }
        #trinkets-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        #items-header button, #trinkets-header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            margin: 0;
            display: flex;
            align-items: center;
            border-radius: 100%;
            filter: brightness(50%) saturate(100%) blur(1px);
            transition: all 0.2s;
            
        }
        #items-header button.active, #trinkets-header button.active {
            background: rgba(246, 214, 176, 0.2);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
            filter: blur(0px);
        }
        #items-header img, #trinkets-header img {
            width: 48px;
            height: 48px;
            pointer-events: none;
            image-rendering: pixelated;
        }

        @media (max-width: 700px) {
            html{
                background-color: rgb(19, 12, 9);
                background-image: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/background_mobile.png');                
                background-repeat: no-repeat;
                background-size: cover;
            }

            #trinkets-header {
                gap: 10px;
            }               
            h2 {font-size: 4em;}         
            .content {
                width: 100vw;
                padding: 2px;
                margin: 0;
                border-radius: 0;
            }
            .img-grid {
                gap: 5px; /* Menor separaci칩n */
            }
            .img-grid img {
                width: 50px;
                height: 50px;
            }
            .search-bar-content {
                width: 100vw;
                margin: 0;
                padding: 0;
                justify-content: center;
            }
            .search-bar {
                font-size: 1.3em;
                padding: 10px 30px 10px 10px;  /* Agregado padding-right para dar espacio a la x */
                width: 70vw;
                box-sizing: border-box;
            }            
            .search-bar-container {
                width: 70vw;
            }
            .clear-search {
                font-size: 2em;
                right: 8px;
            }
            .lang-img {
                width: 48px;
                height: 48px;
                margin-left: 10px;
                padding: 2px;
            }
            .info-img {
                width: 48px;
                height: 48px;
                margin-right: 10px;
                padding: 2px;
            }
            .filter-bar {
                flex-wrap: wrap;
                gap: 2px;
                padding: 5px;
            }
            .filter-btn {
                width: 50px;
                height: 40px;
                font-size: .8em;
                padding-bottom: 2px;
            }
            .modal-content {
                max-width: 70vw;
                padding: 1em 2em;
            }            
            .modal-close {
                right: .2em;
                top: 0;
                font-size: 3em;
            }
            .cat-corner {
                top: 0;
                left: .2em;
                width: 100px;
                height: 100px;
            }
            .modal-nav {
                font-size: 2em;
            }

            .modal-prev {
                left: 5px;
            }

            .modal-next {
                right: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="content">
        <!-- Search bar -->
        <div class="search-bar-content">
            <img id="info-btn" src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/info.png" alt="Cambiar idioma" class="info-img">
            <div class="search-bar-container">
                <input class="search-bar" id="search-bar" type="text" placeholder="Nombre, habitaci칩n, etc...">
                <span class="clear-search" id="clear-search">&times;</span>
            </div>
            <img id="lang-toggle" src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/languages_es.png" alt="Cambiar idioma" class="lang-img">
        </div>
        <!-- Filtro -->
        <div class="filter-bar" id="filter-bar">
            <button class="filter-btn" data-filter="all">
                <span style="pointer-events: none;margin:0;font-family: 'Jersey 10';font-weight: lighter;font-size: 3em;">ALL</span>
            </button>
            <button class="filter-btn" data-filter="shop">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/shop_door.png" alt="Shop" >
            </button>
            <button class="filter-btn" data-filter="itemroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/itemroom_door.png" alt="Item Room" >
            </button>
            <button class="filter-btn" data-filter="planetarium">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/planetarium_door.png" alt="Planetarium" >
            </button>
            <button class="filter-btn" data-filter="library">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/library_door.png" alt="Library" >
            </button>
            <button class="filter-btn" data-filter="curseroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/curseroom_door.png" alt="Curse Room" >
            </button>
            <button class="filter-btn" data-filter="secretroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/secretroom_door.png" alt="Secret Room" >
            </button>
            <button class="filter-btn" data-filter="bossroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/bossroom_door.png" alt="Boss Room" >
            </button>
            <button class="filter-btn" data-filter="devilroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/devilroom_door.png" alt="Devil Room" >
            </button>
            <button class="filter-btn" data-filter="angelroom">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/angelroom_door.png" alt="Angel Room" >
            </button>
            <button class="filter-btn" data-filter="trinkets">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/trinkets.png" alt="Trinkets" >
            </button>
            <button class="filter-btn" data-filter="consumibles">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/pools/consumibles.png" alt="Consumibles" >
            </button>
        </div>
        <div id="items-header">
            <button id="sort-id-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/id.png" alt="Ordenar por ID">
            </button>
            <h2 id="h2-items" style="margin:0;">ITEMS</h2>
            <button id="sort-color-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/color.png" alt="Ordenar por Color">
            </button>
        </div>
        <div id="items" class="img-grid itemgrid"></div>
        <div id="trinkets-header">
            <button id="sort-id-trinkets-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/id.png" alt="Ordenar por ID">
            </button>
            <h2 id="h2-trinkets">TRINKETS</h2>
            <button id="sort-color-trinkets-btn">
                <img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/color.png" alt="Ordenar por Color">
            </button>
        </div>
        <div id="trinkets" class="img-grid trinketgrid"></div>
        <h2 id="h2-cards">MISC</h2>
        <div id="cards" class="img-grid cardgrid"></div>
    </div>
    <!-- Mensaje de error -->
    <div id="error-msg" style="color:red; margin:1em 0;"></div>
    <!-- Modals -->
    <div id="item-modal" class="modal">
        <div class="modal-content" id="modal-content-item">
            <span class="modal-close" id="modal-close-item">&times;</span>
            <!-- Info del item aqu칤 -->
        </div>
    </div>
    <div id="trinket-modal" class="modal">
        <div class="modal-content" id="modal-content-trinket">
            <span class="modal-close" id="modal-close-trinket">&times;</span>
            <!-- Info del trinket aqu칤 -->
        </div>
    </div>
    <div id="card-modal" class="modal">
        <div class="modal-content" id="modal-content-card">
            <span class="modal-close" id="modal-close-card">&times;</span>
            <!-- Info de la card aqu칤 -->
        </div>
    </div>
    
    <div id="info-modal_es" class="modal">
        <div class="modal-content" id="modal-content-info">
            <span class="modal-close" id="modal-close-info">&times;</span>
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;"><img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png" style="pointer-events: none;"><h3>Joker Card</h3><img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png" style="pointer-events: none;"></div>
            <p>Esta es una aplicaci칩n web para consultar r치pidamente informaci칩n sobre los objetos de The Binding of Isaac</p>
            <p>Puedes usar los filtros de la parte superior para mostrar objetos de habitaciones espec칤ficas, o usar la barra de b칰squeda para encontrar objetos por nombre o descripci칩n.</p>
            <p>Haz clic en cualquier objeto para ver su informaci칩n detallada.</p>
            <p>El bot칩n de idioma en la esquina superior derecha permite cambiar entre espa침ol e ingl칠s.</p>
            <img style="width: 75%;border-radius: 20px; border:pink inset 10px; display: block; margin: 0 auto; pointer-events: none;" src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/kokomiLogo.png">
            <p>Esta p치gina ha sido desarrollada especificamente para cubrir las necesidades de mi novia y asegurarme de que en su camino al platinum god se lo pase lo mejor posible</p>
            <p>Todo aquel que la use sabr치 que esto va por ti 游눞游</p>
            <p>P.D. ya descubriras lo que es el platinum god</p>
        </div>
    </div>
    <div id="info-modal_en" class="modal">
        <div class="modal-content" id="modal-content-info">
            <span class="modal-close" id="modal-close-info">&times;</span>
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px;"><img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png"><h3>Joker Card</h3><img src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/icon50.png"></div>
            <p>This is a web application to quickly consult information about items in The Binding of Isaac</p>
            <p>You can use the filters at the top to show items from specific rooms, or use the search bar to find items by name or description.</p>
            <p>Click on any item to see its detailed information.</p>
            <p>The language button in the top right corner allows you to switch between Spanish and English.</p>
            <img style="width: 75%;border-radius: 20px; border:pink inset 10px; display: block; margin: 0 auto;" src="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/kokomiLogo.png">
            <p>This page has been developed specifically to meet my girlfriend's needs and ensure that she enjoys her journey to platinum god as much as possible</p>
            <p>Anyone who uses it will know that this is for you 游눞游</p>
            <p>P.S. you'll find out what platinum god is</p>
        </div>

    <script>
        clearAllGrids(); // Limpia los grids al inicio
        const baseUrl = "https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/";

        // Variables para almacenar los datos
        let allItems = [];
        let allTrinkets = [];
        let allCards = [];
        
        // Estado de orden actual (mover estas declaraciones aqu칤 arriba)
        let sortMode = "id";
        let sortModeTrinkets = "id";

        let language = 'es'; // Por defecto espa침ol

        // Helper para crear im치genes y eventos
        function createImg(src, alt, clickHandler) {
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.style.objectFit = "contain";
            img.onerror = function() { this.style.display = 'none'; };
            img.addEventListener('click', clickHandler);
            return img;
        }

        function initializeButtonStates() {
            // Activar botones de ID al inicio
            document.getElementById('sort-id-btn').classList.add('active');
            document.getElementById('sort-id-trinkets-btn').classList.add('active');
            // Asegurar que los botones de color est칠n desactivados
            document.getElementById('sort-color-btn').classList.remove('active');
            document.getElementById('sort-color-trinkets-btn').classList.remove('active');
        }

        // Modificar la funci칩n loadAllData para llamar a initializeButtonStates
        function loadAllData() {
            // Limpia los arrays antes de cargar
            allItems = [];
            allTrinkets = [];
            allCards = [];
            clearAllGrids();

            // Restablecer el estado de ordenamiento por defecto
            sortMode = "id";
            sortModeTrinkets = "id";
            initializeButtonStates();

            fetch(`${baseUrl}items_${language}.json`)
                .then(res => {
                    return res.json();
                })
                .then(items => { allItems = items; renderByFilters(); })
                .catch(err => {
                });

            fetch(`${baseUrl}trinkets_${language}.json`)
                .then(res => {
                    return res.json();
                })
                .then(trinkets => { allTrinkets = trinkets; renderByFilters(); })
                .catch(err => {
                });

            fetch(`${baseUrl}cards_${language}.json`)
                .then(res => {
                    return res.json();
                })
                .then(cards => { allCards = cards; renderByFilters(); })
                .catch(err => {
                });
        }

        // Inicializa con espa침ol
        loadAllData();

        // Filtros activos
        let activeFilters = [];

        // Limpia todos los grids y oculta los h2
        function clearAllGrids() {
            document.getElementById('items').innerHTML = '';
            document.getElementById('trinkets').innerHTML = '';
            document.getElementById('cards').innerHTML = '';
            document.getElementById('items-header').style.display = 'none';
            document.getElementById('trinkets-header').style.display = 'none';
            document.getElementById('h2-cards').style.display = 'none';
        }

        // Search logic
        document.getElementById('search-bar').addEventListener('input', function(e) {
            window.searchText = e.target.value.trim().toLowerCase();
            // Si no hay filtros activos y hay texto, activa "all"
            if (window.searchText && activeFilters.length === 0) {
                activeFilters = ['all'];
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
            }
            renderByFilters();
        });
        window.searchText = "";
        const searchInput = document.getElementById('search-bar');
        const clearButton = document.getElementById('clear-search');

        searchInput.addEventListener('input', function() {
            clearButton.style.display = this.value ? 'block' : 'none';
        });

        clearButton.addEventListener('click', function() {
            searchInput.value = '';
            window.searchText = '';
            this.style.display = 'none';
            renderByFilters();
        });

        // Renderiza seg칰n los filtros activos
        function renderByFilters() {
            clearAllGrids();
            let showItems = [];
            let showTrinkets = [];
            let showCards = [];

            // Filtrado por filtros
            if (activeFilters.length === 0) {
                // Nada seleccionado, no mostrar nada
            } else if (activeFilters.includes('all')) {
                showItems = allItems;
                showTrinkets = allTrinkets;
                showCards = allCards;
            } else {
                const pools = {
                    shop: 'Shop',
                    itemroom: 'Item Room',
                    bossroom: 'Boss Room',
                    devilroom: 'Devil Room',
                    angelroom: 'Angel Room',
                    curseroom: 'Curse Room',
                    secretroom: 'Secret Room',
                    library: 'Library',
                    planetarium: 'Planetarium'
                };
                let itemFilters = Object.keys(pools).filter(f => activeFilters.includes(f));
                if (itemFilters.length > 0) {
                    showItems = allItems.filter(i =>
                        i.item_pool && itemFilters.some(f =>
                            i.item_pool.some(poolStr =>
                                poolStr && poolStr.toLowerCase().includes(pools[f].toLowerCase())
                            )
                        )
                    );
                }
                if (activeFilters.includes('trinkets')) showTrinkets = allTrinkets;
                if (activeFilters.includes('consumibles')) showCards = allCards;
            }

            // Filtrado por search
            if (window.searchText) {
                const matchesText = obj => {
                    return Object.values(obj).some(val => {
                        if (!val) return false;
                        if (typeof val === 'string') return val.toLowerCase().includes(window.searchText);
                        if (typeof val === 'number') return val.toString().includes(window.searchText);
                        if (Array.isArray(val)) return val.join(' ').toLowerCase().includes(window.searchText);
                        return false;
                    });
                };
                showItems = showItems.filter(matchesText);
                showTrinkets = showTrinkets.filter(matchesText);
                showCards = showCards.filter(matchesText);
            }

            // Render
            if (showItems.length > 0) renderItems(showItems);
            if (showTrinkets.length > 0) renderTrinkets(showTrinkets);
            if (showCards.length > 0) renderCards(showCards);

            document.getElementById('items-header').style.display = document.getElementById('items').children.length ? '' : 'none';
            document.getElementById('trinkets-header').style.display = document.getElementById('trinkets').children.length ? '' : 'none';
            document.getElementById('h2-cards').style.display = document.getElementById('cards').children.length ? '' : 'none';
        }

        function renderItems(items) {
            const container = document.getElementById('items');
            items.forEach(item => {
                if (!item.id) return;
                const img = createImg(
                    `${baseUrl}All_Items/item_${item.id}.png`,
                    item.name,
                    () => showItemModal(item)
                );
                container.appendChild(img);
            });
        }

        function renderTrinkets(trinkets) {
            const container = document.getElementById('trinkets');
            trinkets.forEach(trinket => {
                if (!trinket.trinketId) return;
                const img = createImg(
                    `${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png`,
                    trinket.name,
                    () => showTrinketModal(trinket)
                );
                container.appendChild(img);
            });
        }

        function renderCards(cards) {
            const container = document.getElementById('cards');
            cards.forEach(card => {
                if (!card.cardId) return;
                const img = createImg(
                    `${baseUrl}All_Consumables/card_${card.cardId}.png`,
                    card.name,
                    () => showCardModal(card)
                );
                container.appendChild(img);
            });
        }

        // Filtros: stackeables, "All" es exclusivo
        document.getElementById('filter-bar').addEventListener('click', function(e) {
            if (!e.target.classList.contains('filter-btn')) return;
            const filter = e.target.dataset.filter;

            // Si el bot칩n ya est치 activo, desactivarlo
            if (activeFilters.includes(filter)) {
                activeFilters = [];
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            } else {
                // Desactivar todos los botones y activar solo el nuevo
                activeFilters = [filter];
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
            }

            renderByFilters();
        });

        // MODALS
        // Item modal
        const itemModal = document.getElementById('item-modal');
        const itemModalContent = document.getElementById('modal-content-item');
        function showItemModal(item) {
            let catImg = '';
            if (item.cat === 'up' || item.cat === 'up2' || item.cat === 'down') {
                catImg = `<img src="${baseUrl}cat_${item.cat}.png" alt="cat_${item.cat}" class="cat-corner">`;
            }
            let rechargeImg = '';
            if (item.recharge_time && Array.isArray(item.recharge_time)) {
                const validNumbers = ['1', '2', '3', '4', '6', '12'];
                const firstValue = item.recharge_time[0];
                if (firstValue) {
                    // Extrae el n칰mero al principio del string
                    const match = firstValue.match(/^(\d+)/);
                    if (match && validNumbers.includes(match[1])) {
                        rechargeImg = `<img src="${baseUrl}bars/${match[1]}.png" alt="recharge_${match[1]}" style="margin-left:10px;pointer-events: none;">`;
                    }
                }
            }
            // Encontrar el 칤ndice actual y comprobar si hay anterior/siguiente
            const currentIndex = allItems.findIndex(i => i.id === item.id);
            const prevItem = currentIndex > 0 ? allItems[currentIndex - 1] : null;
            const nextItem = currentIndex < allItems.length - 1 ? allItems[currentIndex + 1] : null;
            itemModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-item">&times;</span>
                ${prevItem ? `<div class="modal-nav modal-prev" onclick="showItemModal(allItems[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextItem ? `<div class="modal-nav modal-next" onclick="showItemModal(allItems[${currentIndex + 1}])">&gt;</div>` : ''}
                <div style="position:relative;display:flex;align-items:center;justify-content:center;">
                    <img src="${baseUrl}All_Items/item_${item.id}.png" alt="${item.name}" style="width:100px;height:100px;display:block;object-fit: contain;pointer-events: none;">
                    ${rechargeImg}
                </div>
                ${catImg}
                <h3>${item.name}</h3>
                ${item.pickup ? `<h3>"${item.pickup}"</h3>` : ''}
                <p>${Array.isArray(item.description) ? item.description.join('<br><br>') : item.description || ''}</p>
                ${item.recharge_time ? `<p><i><strong>USOS:</strong></i> ${item.recharge_time}</p>` : ''}
                <p><i><strong>TIPO:</strong></i> ${item.type_list ? item.type_list.join(', ') : ''}</p>
                ${item.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${item.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${item.id}</p>
            `;
            itemModal.style.display = 'flex';
            document.getElementById('modal-close-item').onclick = () => { itemModal.style.display = 'none'; };
        }
        itemModal.onclick = function(e) {
            if (e.target === itemModal) itemModal.style.display = 'none';
        };

        // Trinket modal
        const trinketModal = document.getElementById('trinket-modal');
        const trinketModalContent = document.getElementById('modal-content-trinket');
        function showTrinketModal(trinket) {
            let catImg = '';
            if (trinket.cat === 'up' || trinket.cat === 'down') {
                catImg = `<img src="${baseUrl}cat_${trinket.cat}.png" alt="cat_${trinket.cat}" class="cat-corner">`;
            }

            // Encontrar el 칤ndice actual y comprobar si hay anterior/siguiente
            const currentIndex = allTrinkets.findIndex(t => t.trinketId === trinket.trinketId);
            const prevTrinket = currentIndex > 0 ? allTrinkets[currentIndex - 1] : null;
            const nextTrinket = currentIndex < allTrinkets.length - 1 ? allTrinkets[currentIndex + 1] : null;

            trinketModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-trinket">&times;</span>
                ${prevTrinket ? `<div class="modal-nav modal-prev" onclick="showTrinketModal(allTrinkets[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextTrinket ? `<div class="modal-nav modal-next" onclick="showTrinketModal(allTrinkets[${currentIndex + 1}])">&gt;</div>` : ''}
                <img src="${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png" alt="${trinket.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;pointer-events: none;">
                ${catImg}
                <h3>${trinket.name}</h3>
                ${trinket.pickup ? `<h3>"${trinket.pickup}"</h3>` : ''}
                <p>${Array.isArray(trinket.description) ? trinket.description.join('<br><br>') : trinket.description || ''}</p>
                ${trinket.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${trinket.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${trinket.trinketId}</p>
            `;
            trinketModal.style.display = 'flex';
            document.getElementById('modal-close-trinket').onclick = () => { trinketModal.style.display = 'none'; };
        }
        trinketModal.onclick = function(e) {
            if (e.target === trinketModal) trinketModal.style.display = 'none';
        };

        // Card modal
        const cardModal = document.getElementById('card-modal');
        const cardModalContent = document.getElementById('modal-content-card');
        function showCardModal(card) {
            let catImg = '';
            if (card.cat === 'up' || card.cat === 'down') {
                catImg = `<img src="${baseUrl}cat_${card.cat}.png" alt="cat_${card.cat}" class="cat-corner">`;
            }

            // Encontrar el 칤ndice actual y comprobar si hay anterior/siguiente
            const currentIndex = allCards.findIndex(c => c.cardId === card.cardId);
            const prevCard = currentIndex > 0 ? allCards[currentIndex - 1] : null;
            const nextCard = currentIndex < allCards.length - 1 ? allCards[currentIndex + 1] : null;

            let description;
            if (card.cardId == 114) {
                description = card.description;
            } else {
                description = Array.isArray(card.description) ? card.description.join('<br><br>') : card.description || '';
            }

            cardModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-card">&times;</span>
                ${prevCard ? `<div class="modal-nav modal-prev" onclick="showCardModal(allCards[${currentIndex - 1}])">&lt;</div>` : ''}
                ${nextCard ? `<div class="modal-nav modal-next" onclick="showCardModal(allCards[${currentIndex + 1}])">&gt;</div>` : ''}
                <img src="${baseUrl}All_Consumables/card_${card.cardId}.png" alt="${card.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;pointer-events: none;">
                ${catImg}
                <h3>${card.name}</h3>
                ${card.pickup ? `<h3>"${card.pickup}"</h3>` : ''}
                <p>${description}</p>
                ${card.unlock ? `<p><i><strong>DESBLOQUEO:</strong></i> ${card.unlock}</p>` : ''}
                <p><i><strong>ID:</strong></i> ${card.cardId}</p>
            `;
            cardModal.style.display = 'flex';
            document.getElementById('modal-close-card').onclick = () => { cardModal.style.display = 'none'; };
        }
        cardModal.onclick = function(e) {
            if (e.target === cardModal) cardModal.style.display = 'none';
        };

        // Info modal
        document.getElementById('info-btn').addEventListener('click', function() {
            let infoModal;
            if (language === 'es') {
                infoModal = document.getElementById('info-modal_es');
            } else {
                infoModal = document.getElementById('info-modal_en'); 
            }
            infoModal.style.display = 'flex';
            
            const closeBtn = infoModal.querySelector('.modal-close');
            closeBtn.onclick = () => {
                infoModal.style.display = 'none';
            };
            
            infoModal.onclick = function(e) {
                if (e.target === infoModal) infoModal.style.display = 'none';
            };
        });

        // Lista de colores en orden crom치tico
        const colorOrder = [
            "white", "silver", "grey", "gray", "black", "brown", "red", "orange", "gold",
            "yellow", "green", "cyan", "blue", "purple", "pink"
        ];

        // Funci칩n para extraer colores de tags
        function getItemColors(item) {
            if (!item.tags) return [];
            const tagsArr = item.tags.split(',').map(t => t.trim().toLowerCase());
            // Devuelve los colores en el orden en que aparecen en los tags
            return tagsArr.filter(tag => colorOrder.includes(tag));
        }

        // Ordena los items por color principal y secundarios
        function sortItemsByColor(items) {
            return items.slice().sort((a, b) => {
                const aColors = getItemColors(a);
                const bColors = getItemColors(b);

                // Si ninguno tiene color, van al final
                if (aColors.length === 0 && bColors.length === 0) return 0;
                if (aColors.length === 0) return 1;
                if (bColors.length === 0) return -1;

                // Orden por color principal
                const aMain = colorOrder.findIndex(c => c === aColors[0]);
                const bMain = colorOrder.findIndex(c => c === bColors[0]);
                if (aMain !== bMain) return aMain - bMain;

                // Si tienen el mismo color principal, compara secundarios
                for (let i = 1; i < Math.max(aColors.length, bColors.length); i++) {
                    const aSec = aColors[i] ? colorOrder.findIndex(c => c === aColors[i]) : Infinity;
                    const bSec = bColors[i] ? colorOrder.findIndex(c => c === bColors[i]) : Infinity;
                    if (aSec !== bSec) return aSec - bSec;
                }

                // Si todo igual, por ID
                return (a.id || 0) - (b.id || 0);
            });
        }

        // Ordena los items por ID
        function sortItemsById(items) {
            return items.slice().sort((a, b) => (a.id || 0) - (b.id || 0));
        }

                function sortTrinketsById(trinkets) {
            return trinkets.slice().sort((a, b) => (a.trinketId || 0) - (b.trinketId || 0));
        }

        function sortTrinketsByColor(trinkets) {
            return trinkets.slice().sort((a, b) => {
                const aColors = getItemColors(a);
                const bColors = getItemColors(b);

                // Si ninguno tiene color, van al final
                if (aColors.length === 0 && bColors.length === 0) return 0;
                if (aColors.length === 0) return 1;
                if (bColors.length === 0) return -1;

                // Orden por color principal
                const aMain = colorOrder.findIndex(c => c === aColors[0]);
                const bMain = colorOrder.findIndex(c => c === bColors[0]);
                if (aMain !== bMain) return aMain - bMain;

                // Si todo igual, por ID
                return (a.trinketId || 0) - (b.trinketId || 0);
            });
        }

        // Modifica renderItems para usar el modo de orden
        function renderItems(items) {
            const container = document.getElementById('items');
            container.innerHTML = '';
            let sortedItems = items;
            if (sortMode === "id") {
                sortedItems = sortItemsById(items);
            } else if (sortMode === "color") {
                sortedItems = sortItemsByColor(items);
            }
            sortedItems.forEach(item => {
                if (!item.id) return;
                const img = createImg(
                    `${baseUrl}All_Items/item_${item.id}.png`,
                    item.name,
                    () => showItemModal(item)
                );
                container.appendChild(img);
            });
        }

        function renderTrinkets(trinkets) {
            const container = document.getElementById('trinkets');
            container.innerHTML = '';
            let sortedTrinkets = trinkets;
            if (sortModeTrinkets === "id") {
                sortedTrinkets = sortTrinketsById(trinkets);
            } else if (sortModeTrinkets === "color") {
                sortedTrinkets = sortTrinketsByColor(trinkets);
            }
            sortedTrinkets.forEach(trinket => {
                if (!trinket.trinketId) return;
                const img = createImg(
                    `${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png`,
                    trinket.name,
                    () => showTrinketModal(trinket)
                );
                container.appendChild(img);
            });
        }

        // Botones de ordenamiento para items
        document.getElementById('sort-id-btn').onclick = function() {
            const idBtn = document.getElementById('sort-id-btn');
            const colorBtn = document.getElementById('sort-color-btn');
            
            if (sortMode === "id") {
                // Si ya est치 en modo ID, desactivar
                sortMode = "default";
                idBtn.classList.remove('active');
            } else {
                // Activar modo ID y desactivar color
                sortMode = "id";
                idBtn.classList.add('active');
                colorBtn.classList.remove('active');
            }
            renderByFilters();
        };

        document.getElementById('sort-color-btn').onclick = function() {
            const idBtn = document.getElementById('sort-id-btn');
            const colorBtn = document.getElementById('sort-color-btn');
            
            if (sortMode === "color") {
                // Si ya est치 en modo color, desactivar
                sortMode = "default";
                colorBtn.classList.remove('active');
            } else {
                // Activar modo color y desactivar ID
                sortMode = "color";
                colorBtn.classList.add('active');
                idBtn.classList.remove('active');
            }
            renderByFilters();
        };

        // Botones de ordenamiento para trinkets
        document.getElementById('sort-id-trinkets-btn').onclick = function() {
            const idBtn = document.getElementById('sort-id-trinkets-btn');
            const colorBtn = document.getElementById('sort-color-trinkets-btn');
            
            if (sortModeTrinkets === "id") {
                // Si ya est치 en modo ID, desactivar
                sortModeTrinkets = "default";
                idBtn.classList.remove('active');
            } else {
                // Activar modo ID y desactivar color
                sortModeTrinkets = "id";
                idBtn.classList.add('active');
                colorBtn.classList.remove('active');
            }
            renderByFilters();
        };

        document.getElementById('sort-color-trinkets-btn').onclick = function() {
            const idBtn = document.getElementById('sort-id-trinkets-btn');
            const colorBtn = document.getElementById('sort-color-trinkets-btn');
            
            if (sortModeTrinkets === "color") {
                // Si ya est치 en modo color, desactivar
                sortModeTrinkets = "default";
                colorBtn.classList.remove('active');
            } else {
                // Activar modo color y desactivar ID
                sortModeTrinkets = "color";
                colorBtn.classList.add('active');
                idBtn.classList.remove('active');
            }
            renderByFilters();
        };

        // Toggle de idioma
        document.getElementById('lang-toggle').addEventListener('click', function() {
            language = (language === 'es') ? 'en' : 'es';
            this.src = `https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/languages_${language}.png`;
            document.getElementById('search-bar').placeholder =
                (language === 'es') ? 'Nombre, habitaci칩n, etc...' : 'Name, room, etc...';
            loadAllData();
        });

        // Soporte para navegaci칩n con teclado
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Cerrar cualquier modal que est칠 abierto
                if (itemModal.style.display === 'flex') itemModal.style.display = 'none';
                if (trinketModal.style.display === 'flex') trinketModal.style.display = 'none';
                if (cardModal.style.display === 'flex') cardModal.style.display = 'none';
                if (document.getElementById('info-modal_es').style.display === 'flex') document.getElementById('info-modal_es').style.display = 'none';
                if (document.getElementById('info-modal_en').style.display === 'flex') document.getElementById('info-modal_en').style.display = 'none';
                return;
            }

            if (itemModal.style.display === 'flex') {
                const currentImg = document.querySelector('#modal-content-item img[style*="width:100px"]');
                const currentName = currentImg.alt;
                const currentIndex = allItems.findIndex(i => i.name === currentName);
                if (e.key === 'ArrowLeft' && currentIndex > 0) {
                    showItemModal(allItems[currentIndex - 1]);
                } else if (e.key === 'ArrowRight' && currentIndex < allItems.length - 1) {
                    showItemModal(allItems[currentIndex + 1]);
                }
            } else if (trinketModal.style.display === 'flex') {
                const currentImg = document.querySelector('#modal-content-trinket img[style*="width:100px"]');
                const currentName = currentImg.alt;
                const currentIndex = allTrinkets.findIndex(t => t.name === currentName);
                if (e.key === 'ArrowLeft' && currentIndex > 0) {
                    showTrinketModal(allTrinkets[currentIndex - 1]);
                } else if (e.key === 'ArrowRight' && currentIndex < allTrinkets.length - 1) {
                    showTrinketModal(allTrinkets[currentIndex + 1]);
                }
            } else if (cardModal.style.display === 'flex') {
                const currentImg = document.querySelector('#modal-content-card img[style*="width:100px"]');
                const currentName = currentImg.alt;
                const currentIndex = allCards.findIndex(c => c.name === currentName);
                if (e.key === 'ArrowLeft' && currentIndex > 0) {
                    showCardModal(allCards[currentIndex - 1]);
                } else if (e.key === 'ArrowRight' && currentIndex < allCards.length - 1) {
                    showCardModal(allCards[currentIndex + 1]);
                }
            }
        });
    </script>
</body>
</html>
