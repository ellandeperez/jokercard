<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&family=Jersey+15&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <title>Joker Card</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/All_Consumables/card_31.png" type="image/x-icon">
    <style>
        html{
            background-color: black;
            background-image: url('https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/background.png');
            background-repeat: repeat-y;
            background-size: contain;
            background-position: center;
            min-height: 100vh;
            width: 100vw;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        body { 
            font-family: Arial, sans-serif;
            margin: 0;
        }
        .content {
            width: 75%;
            margin: 30px auto; /* Centra el contenido */
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 10px;
        }
        h2 { color: rgb(240, 234, 234); text-align: center; font-family: 'Jersey 15';margin: 0 0; text-shadow: rgb(18, 13, 13) 5px 5px 0px, rgb(0, 0, 0) 0px 0px 10px;font-size: 5em;letter-spacing: 5px;}
        h3{text-align:center;margin:0;font-family: 'Jersey 15';font-weight: lighter;font-size: 2em;}
        .img-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px; /* Menor separación */
            align-items: flex-end;   /* Alinea arriba */
            justify-content: flex-start; /* Centra horizontalmente */
            margin: 10px auto; /* Centra el grid en la pantalla */
        }
        .img-grid img {
            image-rendering: pixelated;
            display: block;
            margin: 0;
            transition: all 0.2s;
            z-index: 1;
            cursor: pointer;
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .img-grid img:hover {
            transform: scale(1.5);
            z-index: 1000;
            filter:drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 1px #ffffff)drop-shadow(0 0 10px #ff0000);
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            border: 5px inset #99866e;
            background: #f6d6b0;
            padding: 2em;
            border-radius: 8px;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-content img {
            image-rendering: pixelated;
        }
        .modal-close {
            position: absolute;
            right: 1em;
            top: 1em;
            cursor: pointer;
            font-size: 1.5em;
        }
        .filter-bar {
            position: sticky;
            top: 0;
            background: rgba(0,0,0,0.85);
            z-index: 10;
            display: flex;
            gap: 10px;
            padding: 10px 0 10px 0;
            justify-content: center;
            border-radius: 20px 20px 0 0;
        }
        .filter-btn {
            font-family: 'Jersey 15', Arial, sans-serif;
            font-size: 1.2em;
            padding: 8px 18px;
            border: none;
            border-radius: 8px;
            background: #f6d6b0;
            color: #222;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            outline: none;
        }
        .filter-btn.active {
            background: #99866e;
            color: #fff;
            font-weight: bold;
            box-shadow: 0 0 8px #fff2;
        }
    </style>
</head>
<body>
    <div class="content">
        <!-- Filtro -->
        <div class="filter-bar" id="filter-bar">
            <button class="filter-btn" data-filter="all">All</button>
            <button class="filter-btn" data-filter="shop">Shop</button>
            <button class="filter-btn" data-filter="itemroom">Item Room</button>
            <button class="filter-btn" data-filter="bossroom">Boss Room</button>
            <button class="filter-btn" data-filter="devilroom">Devil Room</button>
            <button class="filter-btn" data-filter="angelroom">Angel Room</button>
            <button class="filter-btn" data-filter="secretroom">Secret Room</button>
            <button class="filter-btn" data-filter="planetarium">Planetarium</button>
            <button class="filter-btn" data-filter="trinkets">Trinkets</button>
            <button class="filter-btn" data-filter="consumibles">Consumibles</button>
            <!-- Ordenar -->
            <button class="filter-btn order-btn" data-order="id">Ordenar por ID</button>
            <button class="filter-btn order-btn" data-order="color">Ordenar por Color</button>
        </div>
        <h2 id="h2-items">ITEMS</h2>
        <div id="items" class="img-grid"></div>
        <h2 id="h2-trinkets">TRINKETS</h2>
        <div id="trinkets" class="img-grid"></div>
        <h2 id="h2-cards">CONSUMIBLES</h2>
        <div id="cards" class="img-grid"></div>
    </div>
    <!-- Mensaje de error -->
    <div id="error-msg" style="color:red; margin:1em 0;"></div>
    <!-- Modals -->
    <div id="item-modal" class="modal">
        <div class="modal-content" id="modal-content-item">
            <span class="modal-close" id="modal-close-item">&times;</span>
            <!-- Info del item aquí -->
        </div>
    </div>
    <div id="trinket-modal" class="modal">
        <div class="modal-content" id="modal-content-trinket">
            <span class="modal-close" id="modal-close-trinket">&times;</span>
            <!-- Info del trinket aquí -->
        </div>
    </div>
    <div id="card-modal" class="modal">
        <div class="modal-content" id="modal-content-card">
            <span class="modal-close" id="modal-close-card">&times;</span>
            <!-- Info de la card aquí -->
        </div>
    </div>

    <script>
        clearAllGrids(); // Limpia los grids al inicio
        const baseUrl = "https://raw.githubusercontent.com/ellandeperez/jokercard/refs/heads/main/";

        // Variables para almacenar los datos
        let allItems = [];
        let allTrinkets = [];
        let allCards = [];

        // Helper para crear imágenes y eventos
        function createImg(src, alt, clickHandler) {
            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.style.objectFit = "contain";
            img.onerror = function() { this.style.display = 'none'; };
            img.addEventListener('click', clickHandler);
            return img;
        }

        // Cargar datos pero no mostrar nada aún
        fetch(`${baseUrl}items.json`)
            .then(res => {
                if (!res.ok) throw new Error('No se pudo cargar items.json');
                return res.json();
            })
            .then(items => { allItems = items; })
            .catch(err => {
                document.getElementById('error-msg').textContent =
                    "Error cargando items.json. Si estás abriendo el archivo localmente, usa un servidor local (por ejemplo: 'npx serve', 'python -m http.server', etc).";
            });

        fetch(`${baseUrl}trinkets.json`)
            .then(res => {
                if (!res.ok) throw new Error('No se pudo cargar trinkets.json');
                return res.json();
            })
            .then(trinkets => { allTrinkets = trinkets; })
            .catch(err => {
                document.getElementById('error-msg').textContent +=
                    "\nError cargando trinkets.json.";
            });

        fetch(`${baseUrl}cards.json`)
            .then(res => {
                if (!res.ok) throw new Error('No se pudo cargar cards.json');
                return res.json();
            })
            .then(cards => { allCards = cards; })
            .catch(err => {
                document.getElementById('error-msg').textContent +=
                    "\nError cargando cards.json.";
            });

        // Filtros activos
        let activeFilters = [];

        // Orden activo: 'id', 'color' o null
        let activeOrder = null;

        // Colores reconocidos para ordenar
        const colorList = [
            "red", "blue", "green", "yellow", "purple", "pink", "brown", "black", "white", "orange", "grey", "gray", "cyan", "gold", "silver"
        ];

        // Limpia todos los grids y oculta los h2
        function clearAllGrids() {
            document.getElementById('items').innerHTML = '';
            document.getElementById('trinkets').innerHTML = '';
            document.getElementById('cards').innerHTML = '';
            document.getElementById('h2-items').style.display = 'none';
            document.getElementById('h2-trinkets').style.display = 'none';
            document.getElementById('h2-cards').style.display = 'none';
        }

        // Devuelve el primer color encontrado en tags
        function getFirstColor(tags) {
            if (!tags) return null;
            const tagStr = Array.isArray(tags) ? tags.join(' ').toLowerCase() : tags.toLowerCase();
            for (const color of colorList) {
                if (tagStr.includes(color)) return color;
            }
            return null;
        }

        // Renderiza según los filtros activos y el orden activo
        function renderByFilters() {
            clearAllGrids();
            let showItems = [];
            let showTrinkets = false;
            let showCards = false;

            if (activeFilters.length === 0) {
                // Nada seleccionado, no mostrar nada
            } else if (activeFilters.includes('all')) {
                showItems = allItems.slice();
                showTrinkets = true;
                showCards = true;
            } else {
                const pools = {
                    shop: 'Shop',
                    itemroom: 'Item Room',
                    bossroom: 'Boss Room',
                    devilroom: 'Devil Room',
                    angelroom: 'Angel Room',
                    secretroom: 'Secret Room',
                    planetarium: 'Planetarium'
                };
                let itemFilters = Object.keys(pools).filter(f => activeFilters.includes(f));
                if (itemFilters.length > 0) {
                    showItems = allItems.filter(i =>
                        i.item_pool && itemFilters.some(f => i.item_pool.includes(pools[f]))
                    );
                }
                if (activeFilters.includes('trinkets')) showTrinkets = true;
                if (activeFilters.includes('consumibles')) showCards = true;
            }

            // Ordenar si corresponde
            if (activeOrder === 'id') {
                showItems.sort((a, b) => Number(a.id) - Number(b.id));
            } else if (activeOrder === 'color') {
                showItems.sort((a, b) => {
                    const colorA = getFirstColor(a.tags);
                    const colorB = getFirstColor(b.tags);
                    if (colorA === colorB) return 0;
                    if (!colorA) return 1;
                    if (!colorB) return -1;
                    return colorList.indexOf(colorA) - colorList.indexOf(colorB);
                });
            }

            if (showItems.length > 0) renderItems(showItems);
            if (showTrinkets) renderTrinkets(allTrinkets);
            if (showCards) renderCards(allCards);

            document.getElementById('h2-items').style.display = document.getElementById('items').children.length ? '' : 'none';
            document.getElementById('h2-trinkets').style.display = document.getElementById('trinkets').children.length ? '' : 'none';
            document.getElementById('h2-cards').style.display = document.getElementById('cards').children.length ? '' : 'none';
        }

        function renderItems(items) {
            const container = document.getElementById('items');
            items.forEach(item => {
                if (!item.id) return;
                const img = createImg(
                    `${baseUrl}All_Items/item_${item.id}.png`,
                    item.name,
                    () => showItemModal(item)
                );
                container.appendChild(img);
            });
        }

        function renderTrinkets(trinkets) {
            const container = document.getElementById('trinkets');
            trinkets.forEach(trinket => {
                if (!trinket.trinketId) return;
                const img = createImg(
                    `${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png`,
                    trinket.name,
                    () => showTrinketModal(trinket)
                );
                container.appendChild(img);
            });
        }

        function renderCards(cards) {
            const container = document.getElementById('cards');
            cards.forEach(card => {
                if (!card.cardId) return;
                const img = createImg(
                    `${baseUrl}All_Consumables/card_${card.cardId}.png`,
                    card.name,
                    () => showCardModal(card)
                );
                container.appendChild(img);
            });
        }

        // Filtros: stackeables, "All" es exclusivo
        document.getElementById('filter-bar').addEventListener('click', function(e) {
            if (e.target.classList.contains('order-btn')) {
                // Botones de orden: toggle exclusivo entre ellos
                const order = e.target.dataset.order;
                if (activeOrder === order) {
                    activeOrder = null;
                    e.target.classList.remove('active');
                } else {
                    activeOrder = order;
                    document.querySelectorAll('.order-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
                renderByFilters();
                return;
            }
            if (!e.target.classList.contains('filter-btn')) return;
            if (e.target.classList.contains('order-btn')) return; // Ya gestionado arriba
            const filter = e.target.dataset.filter;

            if (filter === 'all') {
                // Si ya está activo, desactívalo (toggle real)
                if (activeFilters.includes('all')) {
                    activeFilters = [];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                } else {
                    activeFilters = ['all'];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            } else {
                // Si "all" está activo, desactívalo
                if (activeFilters.includes('all')) {
                    activeFilters = [];
                    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                }
                // Toggle real del filtro
                if (activeFilters.includes(filter)) {
                    activeFilters = activeFilters.filter(f => f !== filter);
                    e.target.classList.remove('active');
                } else {
                    activeFilters.push(filter);
                    e.target.classList.add('active');
                }
            }
            // Marcar los botones activos
            if (!activeFilters.includes('all')) {
                document.querySelector('.filter-btn[data-filter="all"]').classList.remove('active');
            }
            // Si no hay filtros activos, desmarcar todos
            if (activeFilters.length === 0) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            }
            // Mantener el estado de los botones de orden
            document.querySelectorAll('.order-btn').forEach(btn => {
                if (btn.dataset.order === activeOrder) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            renderByFilters();
        });

        // MODALS
        // Item modal
        const itemModal = document.getElementById('item-modal');
        const itemModalContent = document.getElementById('modal-content-item');
        function showItemModal(item) {
            itemModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-item">&times;</span>
                <img src="${baseUrl}All_Items/item_${item.id}.png" alt="${item.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;">
                <h3>${item.name}</h3>
                ${item.pickup ? `<h3>"${item.pickup}"</h3>` : ''}
                <p>${Array.isArray(item.description) ? item.description.join('<br><br>') : item.description || ''}</p>
                ${item.recharge_time ? `<p><strong>Recarga:</strong> ${item.recharge_time}</p>` : ''}
                <p><strong>Tipo:</strong> ${item.type_list ? item.type_list.join(', ') : ''}</p>
                ${item.unlock ? `<p><strong>Como se desbloquea:</strong> ${item.unlock}</p>` : ''}
            `;
            itemModal.style.display = 'flex';
            document.getElementById('modal-close-item').onclick = () => { itemModal.style.display = 'none'; };
        }
        itemModal.onclick = function(e) {
            if (e.target === itemModal) itemModal.style.display = 'none';
        };

        // Trinket modal
        const trinketModal = document.getElementById('trinket-modal');
        const trinketModalContent = document.getElementById('modal-content-trinket');
        function showTrinketModal(trinket) {
            trinketModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-trinket">&times;</span>
                <img src="${baseUrl}All_Trinkets/trinket_${trinket.trinketId}.png" alt="${trinket.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;">
                <h3>${trinket.name}</h3>
                ${trinket.pickup ? `<h3>"${trinket.pickup}"</h3>` : ''}
                <p>${Array.isArray(trinket.description) ? trinket.description.join('<br><br>') : trinket.description || ''}</p>
                ${trinket.unlock ? `<p><strong>Como se desbloquea:</strong> ${trinket.unlock}</p>` : ''}
            `;
            trinketModal.style.display = 'flex';
            document.getElementById('modal-close-trinket').onclick = () => { trinketModal.style.display = 'none'; };
        }
        trinketModal.onclick = function(e) {
            if (e.target === trinketModal) trinketModal.style.display = 'none';
        };

        // Card modal
        const cardModal = document.getElementById('card-modal');
        const cardModalContent = document.getElementById('modal-content-card');
        function showCardModal(card) {
            cardModalContent.innerHTML = `
                <span class="modal-close" id="modal-close-card">&times;</span>
                <img src="${baseUrl}All_Consumables/card_${card.cardId}.png" alt="${card.name}" style="width:100px;height:100px;display:block;margin:auto;object-fit: contain;">
                <h3>${card.name}</h3>
                ${card.pickup ? `<h3>"${card.pickup}"</h3>` : ''}
                <p>${Array.isArray(card.description) ? card.description.join('<br><br>') : card.description || ''}</p>
                ${card.unlock ? `<p><strong>Como se desbloquea:</strong> ${card.unlock}</p>` : ''}
            `;
            cardModal.style.display = 'flex';
            document.getElementById('modal-close-card').onclick = () => { cardModal.style.display = 'none'; };
        }
        cardModal.onclick = function(e) {
            if (e.target === cardModal) cardModal.style.display = 'none';
        };
    </script>
</body>
</html>
